{"version":3,"sources":["../src/index.ts","../package.json","../src/loaders/config-loader.ts","../src/services/introspect.ts","../src/services/migrate.ts","../src/services/diff.ts","../src/services/generator.ts","../src/services/state.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { Command } from \"commander\";\nimport { version } from \"../package.json\";\n\nimport { initConfig } from \"./loaders/config-loader\";\nimport { introspect } from \"./services/introspect\";\nimport {\n  generateMigration,\n  preview,\n  rebuildSnapshot,\n  rollbackLast,\n  runMigrations,\n  validateSnapshot,\n} from \"./services/migrate\";\nimport { listBackups, restoreBackup } from \"./services/state\";\n\nfunction wrap(fn: (...args: any[]) => Promise<any>) {\n  return async (...args: any[]) => {\n    try {\n      await fn(...args);\n    } catch (err) {\n      console.error(\"Error:\", err);\n      process.exit(1);\n    }\n  };\n}\n\nexport async function runCli() {\n  const program = new Command();\n\n  program\n    .name(\"seqmig\")\n    .description(\"Sequelize auto-migration CLI\")\n    .version(version);\n\n  program\n    .command(\"init\")\n    .description(\"Initialize .seqmigrc configuration file\")\n    .action(() => {\n      initConfig();\n    });\n\n  program\n    .command(\"preview\")\n    .description(\"Preview schema diff\")\n    .action(wrap(preview));\n\n  program\n    .command(\"generate\")\n    .description(\"Generate migration file\")\n    .action(wrap(generateMigration));\n\n  program\n    .command(\"run\")\n    .description(\"Run pending migrations\")\n    .action(wrap(runMigrations));\n\n  program\n    .command(\"rollback\")\n    .description(\"Rollback last migration\")\n    .action(wrap(rollbackLast));\n\n  program\n    .command(\"rebuild\")\n    .description(\"Rebuild snapshot\")\n    .action(wrap(rebuildSnapshot));\n\n  program\n    .command(\"validate\")\n    .description(\"Validate snapshot\")\n    .action(wrap(validateSnapshot));\n\n  program\n    .command(\"backups\")\n    .description(\"List snapshot backups\")\n    .action(() => {\n      const backups = listBackups();\n      if (backups.length === 0) {\n        console.log(\"No backups found.\");\n        return;\n      }\n      console.log(\"Available backups:\");\n      backups.forEach((b, i) => console.log(`${i + 1}. ${b}`));\n    });\n\n  program\n    .command(\"restore <backup>\")\n    .description(\"Restore snapshot\")\n    .action((backup: string) => {\n      restoreBackup(backup);\n    });\n\n  program\n    .command(\"introspect\")\n    .description(\"Introspect DB schema\")\n    .action(\n      wrap(async () => {\n        const result = await introspect();\n        console.log(JSON.stringify(result, null, 2));\n      })\n    );\n\n  await program.parseAsync(process.argv);\n}\n\nif (require.main === module) {\n  runCli();\n}\n","{\n  \"name\": \"seqmig\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Sequelize auto-migration CLI\",\n  \"main\": \"dist/index.js\",\n  \"bin\": {\n    \"seqmig\": \"dist/index.js\"\n  },\n  \"scripts\": {\n    \"build\": \"tsup\",\n    \"version-packages\": \"changeset version\",\n    \"release\": \"changeset publish\",\n    \"changeset\": \"changeset\"\n  },\n  \"keywords\": [\n    \"sequelize\",\n    \"migration\",\n    \"auto-migration\",\n    \"cli\",\n    \"database\"\n  ],\n  \"author\": \"Sandip Shrestha <sandipstha139@gmail.com>\",\n  \"license\": \"ISC\",\n  \"packageManager\": \"pnpm@10.14.0\",\n  \"dependencies\": {\n    \"commander\": \"^14.0.2\",\n    \"execa\": \"^9.6.1\",\n    \"pg\": \"^8.16.3\",\n    \"reflect-metadata\": \"^0.2.2\",\n    \"sequelize\": \"^6.37.7\",\n    \"sequelize-cli\": \"^6.6.3\",\n    \"sequelize-typescript\": \"^2.1.6\",\n    \"tsx\": \"^4.21.0\",\n    \"yaml\": \"^2.8.2\"\n  },\n  \"devDependencies\": {\n    \"@changesets/cli\": \"^2.29.8\",\n    \"@types/node\": \"^24.10.1\",\n    \"ts-node\": \"^10.9.2\",\n    \"tsup\": \"^8.5.1\",\n    \"typescript\": \"^5.9.3\"\n  }\n}\n","import fs from \"fs\";\nimport path from \"path\";\n\nexport interface SeqmigConfig {\n  configFile: string;\n  modelsPath: string;\n  migrationDir: string;\n  seedersPath: string;\n  snapshotDir: string;\n  url?: string;\n  debug?: boolean;\n  tsconfigPath?: string;\n}\n\nexport function loadSeqmigConfig(): SeqmigConfig {\n  const rcPath = path.join(process.cwd(), \".sequelizerc\");\n\n  let rc: any = {};\n  if (fs.existsSync(rcPath)) {\n    rc = require(rcPath) ?? {};\n  }\n\n  const resolve = (p: string | undefined, fallback: string) =>\n    !p\n      ? path.resolve(fallback)\n      : path.isAbsolute(p)\n      ? p\n      : path.resolve(process.cwd(), p);\n\n  return {\n    configFile: resolve(rc.config, \"config/config.js\"),\n    modelsPath: resolve(rc[\"models-path\"], \"models\"),\n    migrationDir: resolve(rc[\"migrations-path\"], \"migrations\"),\n    seedersPath: resolve(rc[\"seeders-path\"], \"seeders\"),\n    snapshotDir: path.resolve(\".seqmig/snapshots\"),\n    url: rc.url,\n    debug: rc.debug,\n    tsconfigPath: rc[\"tsconfig-path\"],\n  };\n}\n\nexport function loadSequelizeConfig(): any {\n  const cfg = loadSeqmigConfig();\n\n  if (cfg.url) {\n    return {\n      url: cfg.url,\n      dialect: \"postgres\",\n      logging: false,\n    };\n  }\n\n  const configPath = cfg.configFile;\n\n  if (!fs.existsSync(configPath)) {\n    throw new Error(`Sequelize config file not found: ${configPath}`);\n  }\n\n  delete require.cache[require.resolve(configPath)];\n  const config = require(configPath);\n\n  const env = process.env.NODE_ENV || \"development\";\n  const db = config[env] || config;\n\n  if (!db.username) throw new Error(`Missing username in Sequelize config`);\n  if (!db.database) throw new Error(`Missing database in Sequelize config`);\n  if (!db.host) throw new Error(`Missing host in Sequelize config`);\n\n  return {\n    username: String(db.username),\n    password: db.password ? String(db.password) : \"\",\n    database: String(db.database),\n    host: String(db.host),\n    port: Number(db.port || 5432),\n    dialect: db.dialect || \"postgres\",\n    logging: false,\n  };\n}\n\nexport function initConfig() {\n  const rcPath = path.join(process.cwd(), \".sequelizerc\");\n\n  if (fs.existsSync(rcPath)) {\n    console.log(\".sequelizerc already exists\");\n    return;\n  }\n\n  const template = `\nconst path = require(\"path\");\n\nmodule.exports = {\n  config: path.resolve(\"config/config.js\"),\n  \"models-path\": path.resolve(\"models\"),\n  \"migrations-path\": path.resolve(\"migrations\"),\n  \"seeders-path\": path.resolve(\"seeders\")\n};\n`.trimStart();\n\n  fs.writeFileSync(rcPath, template);\n  console.log(\"Created .sequelizerc\");\n}\n","import \"reflect-metadata\";\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport { Sequelize } from \"sequelize-typescript\";\nimport {\n  loadSeqmigConfig,\n  loadSequelizeConfig,\n} from \"../loaders/config-loader\";\nimport {\n  CheckConstraintSchema,\n  ColumnSchema,\n  DatabaseSchema,\n  ForeignKeySchema,\n  IndexSchema,\n  UniqueConstraintSchema,\n} from \"./schema-types\";\n\nfunction registerRuntime() {\n  try {\n    require(\"tsx/esm\");\n  } catch (e) {\n    console.warn(\"tsx not found. Only JS will load.\");\n  }\n}\nfunction toScalar(db: string): any {\n  const t = db.toUpperCase();\n  if (t.includes(\"ARRAY\")) return \"ARRAY\";\n  if (t.startsWith(\"ENUM\") || t.includes(\"ENUM(\")) return \"ENUM\";\n  if (t.includes(\"UUID\")) return \"UUID\";\n  if (t.includes(\"TIMESTAMP\") || t.includes(\"DATE\")) return \"DATE\";\n  if (t.includes(\"BIGINT\")) return \"BIGINT\";\n  if (t.includes(\"INT\")) return \"INTEGER\";\n  if (t.includes(\"TEXT\")) return \"TEXT\";\n  if (t.includes(\"CHAR\") || t.includes(\"STRING\")) return \"STRING\";\n  if (t.includes(\"BOOLEAN\")) return \"BOOLEAN\";\n  if (t.includes(\"JSONB\")) return \"JSONB\";\n  if (t.includes(\"JSON\")) return \"JSON\";\n  if (t.includes(\"DECIMAL\")) return \"DECIMAL\";\n  if (t.includes(\"FLOAT\")) return \"FLOAT\";\n  return \"STRING\";\n}\n\nfunction extractEnumValues(dbType: string): string[] | undefined {\n  const upper = dbType.toUpperCase();\n  if (!upper.startsWith(\"ENUM\") && !upper.includes(\"ENUM(\")) return undefined;\n\n  const startIdx = dbType.indexOf(\"(\");\n  const endIdx = dbType.lastIndexOf(\")\");\n\n  if (startIdx === -1 || endIdx === -1) return undefined;\n\n  const inner = dbType.slice(startIdx + 1, endIdx);\n  return inner.split(\",\").map((v) => v.trim().replace(/^[\"']+|[\"']+$/g, \"\"));\n}\n\nfunction isManyToManyJoinTable(\n  tableName: string,\n  columns: ColumnSchema[],\n  foreignKeys: ForeignKeySchema[],\n  indexes: IndexSchema[]\n): boolean {\n  if (foreignKeys.length < 2) return false;\n  const fkColumns = foreignKeys.map((fk) => fk.column);\n  const hasCompositeUnique = indexes.some((idx) => {\n    if (!idx.unique) return false;\n    const fkInIndex = idx.columns.filter((col) => fkColumns.includes(col));\n    return fkInIndex.length >= 2;\n  });\n  return hasCompositeUnique;\n}\n\nfunction getAllModelFiles(dir: string): string[] {\n  const files: string[] = [];\n\n  if (!fs.existsSync(dir)) {\n    throw new Error(`Models directory not found: ${dir}`);\n  }\n\n  const items = fs.readdirSync(dir);\n\n  for (const item of items) {\n    const fullPath = path.join(dir, item);\n    const stat = fs.statSync(fullPath);\n\n    if (stat.isDirectory()) {\n      files.push(...getAllModelFiles(fullPath));\n    } else if (\n      (item.endsWith(\".ts\") || item.endsWith(\".js\")) &&\n      !item.endsWith(\".d.ts\") &&\n      item !== \"index.ts\" &&\n      item !== \"index.js\"\n    ) {\n      files.push(fullPath);\n    }\n  }\n\n  return files;\n}\n\nexport async function introspect(): Promise<DatabaseSchema> {\n  registerRuntime();\n\n  const cfg = loadSequelizeConfig();\n  const seqmigConfig = loadSeqmigConfig();\n\n  const sequelize = new Sequelize({\n    ...cfg,\n    logging: false,\n  });\n\n  // Fix for sequelize-typescript require() issue\n  (sequelize as any).import = (filePath: string) => {\n    // Ensures .ts extension is included\n    if (!filePath.endsWith(\".ts\") && !filePath.endsWith(\".js\")) {\n      if (fs.existsSync(filePath + \".ts\")) filePath = filePath + \".ts\";\n      if (fs.existsSync(filePath + \".js\")) filePath = filePath + \".js\";\n    }\n\n    return import(filePath);\n  };\n\n  const modelsPath = path.isAbsolute(seqmigConfig.modelsPath!)\n    ? seqmigConfig.modelsPath!\n    : path.join(process.cwd(), seqmigConfig.modelsPath!);\n\n  const modelFiles = getAllModelFiles(modelsPath);\n  // FIX: manually import model classes (ESM-compatible)\n  const modelClasses = [];\n\n  for (const file of modelFiles) {\n    const mod = await import(file); // dynamic import works with .ts\n    const modelClass = mod.default || Object.values(mod)[0];\n    modelClasses.push(modelClass);\n  }\n\n  sequelize.addModels(modelClasses);\n\n  await sequelize.authenticate();\n  const schema: DatabaseSchema = { tables: [] };\n  const models = sequelize.models;\n\n  for (const [modelName, m] of Object.entries(models)) {\n    const tableName = String(m.getTableName());\n    const attrs = m.getAttributes();\n\n    const columns: ColumnSchema[] = Object.entries(attrs).map(\n      ([name, a]: any) => {\n        const raw = a.type?.toString() || \"STRING\";\n\n        const isArray =\n          raw.toUpperCase().includes(\"ARRAY\") ||\n          (a.type && a.type.key === \"ARRAY\") ||\n          (a.type && a.type.constructor && a.type.constructor.name === \"ARRAY\");\n\n        const isEnum =\n          raw.toUpperCase().includes(\"ENUM\") ||\n          (a.type && a.type.key === \"ENUM\") ||\n          (a.type &&\n            a.type.constructor &&\n            a.type.constructor.name === \"ENUM\") ||\n          (a.type && a.type.values && Array.isArray(a.type.values));\n\n        let enumValues: string[] | undefined;\n        if (isEnum) {\n          if (a.type && a.type.values && Array.isArray(a.type.values)) {\n            enumValues = a.type.values;\n          } else {\n            enumValues = extractEnumValues(raw);\n          }\n        }\n\n        let defaultValue = a.defaultValue;\n        let hasDefault = false;\n\n        if (defaultValue !== null && defaultValue !== undefined) {\n          const defaultStr = String(defaultValue);\n\n          if (defaultStr.includes(\"::\")) {\n            const beforeTypeCast = defaultStr.split(\"::\")[0].trim();\n\n            if (\n              beforeTypeCast.toUpperCase() === \"NULL\" ||\n              beforeTypeCast === \"\"\n            ) {\n              defaultValue = null;\n              hasDefault = false;\n            } else {\n              defaultValue = beforeTypeCast.replace(/^'(.*)'$/, \"$1\");\n              hasDefault = true;\n            }\n          } else if (defaultStr === \"undefined\") {\n            defaultValue = null;\n            hasDefault = false;\n          } else if (\n            typeof defaultValue === \"function\" ||\n            defaultStr === \"[Function]\" ||\n            defaultStr.includes(\"function\") ||\n            defaultStr.includes(\"now()\")\n          ) {\n            if (\n              (name === \"createdAt\" || name === \"updatedAt\") &&\n              (raw.toUpperCase().includes(\"DATE\") ||\n                raw.toUpperCase().includes(\"TIMESTAMP\"))\n            ) {\n              hasDefault = true;\n              defaultValue = \"NOW\";\n            } else if (name === \"id\" && raw.toUpperCase().includes(\"UUID\")) {\n              hasDefault = true;\n              defaultValue = \"UUID_FUNCTION\";\n            } else {\n              defaultValue = null;\n              hasDefault = false;\n            }\n          } else {\n            hasDefault = true;\n          }\n        }\n\n        if (!hasDefault && (name === \"createdAt\" || name === \"updatedAt\")) {\n          if (\n            raw.toUpperCase().includes(\"DATE\") ||\n            raw.toUpperCase().includes(\"TIMESTAMP\")\n          ) {\n            hasDefault = true;\n            defaultValue = \"NOW\";\n          }\n        }\n\n        if (defaultValue === undefined) {\n          defaultValue = null;\n          hasDefault = false;\n        }\n\n        const allowNull = a.allowNull === false ? false : true;\n\n        const column: any = {\n          name,\n          type: isArray ? \"ARRAY\" : isEnum ? \"ENUM\" : toScalar(raw),\n          dbType: raw,\n          allowNull: allowNull,\n          primaryKey: !!a.primaryKey,\n          unique:\n            !!a.unique || a.unique === true || typeof a.unique === \"string\",\n          autoIncrement: !!a.autoIncrement,\n          comment: a.comment || null,\n          enumValues: enumValues,\n        };\n\n        if (hasDefault) {\n          column.defaultValue = defaultValue;\n        }\n\n        return column;\n      }\n    );\n\n    const primaryKeys = columns.filter((c) => c.primaryKey).map((c) => c.name);\n\n    const rawIndexes: IndexSchema[] =\n      (m as any).options.indexes?.map((idx: any) => ({\n        name: idx.name,\n        columns: idx.fields,\n        unique: !!idx.unique,\n        where: idx.where || null,\n        type: idx.type || null,\n        using: idx.using || null,\n      })) || [];\n\n    const uniques: UniqueConstraintSchema[] = [];\n    const uniqueColumnNames = new Set<string>();\n    const uniqueNameToColumns = new Map<string, string[]>();\n\n    columns.forEach((col) => {\n      if (col.unique && !col.primaryKey) {\n        const attr = attrs[col.name];\n        const uniqueValue = (attr as any).unique;\n\n        let uniqueName: string;\n        if (typeof uniqueValue === \"string\") {\n          uniqueName = uniqueValue;\n          if (!uniqueNameToColumns.has(uniqueName)) {\n            uniqueNameToColumns.set(uniqueName, []);\n          }\n          uniqueNameToColumns.get(uniqueName)!.push(col.name);\n        } else {\n          uniqueName = `${tableName}_${col.name}_unique`;\n          uniques.push({\n            name: uniqueName,\n            columns: [col.name],\n          });\n          uniqueColumnNames.add(col.name);\n        }\n      }\n    });\n\n    uniqueNameToColumns.forEach((cols, name) => {\n      uniques.push({\n        name,\n        columns: cols,\n      });\n      cols.forEach((col) => uniqueColumnNames.add(col));\n    });\n\n    const uniqueKeys = ((m as any).options as any)?.uniqueKeys;\n    if (uniqueKeys) {\n      Object.entries(uniqueKeys).forEach(([name, cfg]: any) => {\n        const isDuplicate = uniques.some(\n          (u) =>\n            u.name === name ||\n            JSON.stringify(u.columns.sort()) ===\n              JSON.stringify(cfg.fields.sort())\n        );\n\n        if (!isDuplicate) {\n          uniques.push({ name, columns: cfg.fields });\n          cfg.fields.forEach((field: string) => uniqueColumnNames.add(field));\n        }\n      });\n    }\n\n    rawIndexes.forEach((idx) => {\n      if (idx.unique) {\n        const isDuplicate = uniques.some(\n          (u) =>\n            u.name === idx.name ||\n            JSON.stringify(u.columns.sort()) ===\n              JSON.stringify(idx.columns.sort())\n        );\n\n        if (!isDuplicate) {\n          uniques.push({\n            name: idx.name,\n            columns: idx.columns,\n          });\n          idx.columns.forEach((col) => uniqueColumnNames.add(col));\n        }\n      }\n    });\n\n    uniqueColumnNames.forEach((colName) => {\n      const col = columns.find((c) => c.name === colName);\n      if (col) {\n        col.unique = false;\n      }\n    });\n\n    const indexes = rawIndexes.filter((idx) => {\n      if (idx.unique) return false;\n\n      if (idx.columns.some((col) => uniqueColumnNames.has(col))) {\n        return false;\n      }\n\n      return true;\n    });\n\n    const checks: CheckConstraintSchema[] = [];\n    const validate = ((m as any).options as any)?.validate;\n    if (validate) {\n      Object.entries(validate).forEach(([name, expr]: any) => {\n        if (typeof expr === \"string\") {\n          checks.push({ name, expression: expr });\n        }\n      });\n    }\n\n    const foreignKeys: ForeignKeySchema[] = [];\n\n    Object.values((m as any).associations).forEach((assoc: any) => {\n      if (assoc.associationType === \"BelongsTo\") {\n        const fk = assoc.foreignKey;\n        const col = columns.find((c) => c.name === fk);\n        if (col) col.unique = false;\n\n        foreignKeys.push({\n          name: assoc.options?.constraintName || `${tableName}_${fk}_fkey`,\n          column: fk,\n          referencedTable: assoc.target.getTableName(),\n          referencedColumn: assoc.target.primaryKeyAttribute,\n          onDelete: assoc.options?.onDelete || \"CASCADE\",\n          onUpdate: assoc.options?.onUpdate || \"CASCADE\",\n        });\n      }\n    });\n\n    const isJoinTable = isManyToManyJoinTable(\n      tableName,\n      columns,\n      foreignKeys,\n      indexes\n    );\n\n    if (isJoinTable) {\n      const fkColumns = foreignKeys.map((fk) => fk.column);\n      const mainFKs = fkColumns.slice(0, 2);\n\n      const hasUniqueConstraint = uniques.some((u) => {\n        const sortedU = [...u.columns].sort();\n        const sortedFK = [...mainFKs].sort();\n        return (\n          sortedU.length === sortedFK.length &&\n          sortedU.every((col, i) => col === sortedFK[i])\n        );\n      });\n\n      if (!hasUniqueConstraint) {\n        const constraintName = `${tableName}_${mainFKs.join(\"_\")}_uq`;\n        uniques.push({\n          name: constraintName,\n          columns: mainFKs,\n        });\n      }\n\n      fkColumns.forEach((fkCol) => {\n        const col = columns.find((c) => c.name === fkCol);\n        if (col) col.unique = false;\n      });\n    }\n\n    schema.tables.push({\n      name: tableName,\n      columns,\n      indexes,\n      foreignKeys,\n      uniques,\n      checks,\n      primaryKeys,\n    });\n  }\n\n  return schema;\n}\n","import { execa } from \"execa\";\nimport { diff } from \"./diff\";\nimport { generate } from \"./generator\";\nimport { introspect } from \"./introspect\";\nimport { loadSnapshot, saveSnapshot } from \"./state\";\n\nexport async function preview() {\n  const before = loadSnapshot();\n  const after = await introspect();\n  const actions = diff(before, after);\n  console.log(JSON.stringify(actions, null, 2));\n}\n\nexport async function generateMigration() {\n  const before = loadSnapshot();\n  const after = await introspect();\n  const actions = diff(before, after);\n\n  if (!actions.length) {\n    console.log(\"No schema changes detected. No migration generated.\");\n    return;\n  }\n\n  const file = generate(actions);\n  saveSnapshot(after);\n  console.log(\"Generated migration:\", file);\n}\n\nexport async function runMigrations() {\n  console.log(\"Running migrations via sequelize-cli...\\n\");\n\n  await execa(\"npx\", [\"sequelize-cli\", \"db:migrate\"], {\n    stdio: \"inherit\",\n  });\n}\n\nexport async function rollbackLast() {\n  console.log(\"Rolling back last migration via sequelize-cli...\\n\");\n\n  await execa(\"npx\", [\"sequelize-cli\", \"db:migrate:undo\"], {\n    stdio: \"inherit\",\n  });\n}\n\nexport async function rebuildSnapshot() {\n  console.log(\"Rebuilding snapshot in 3 seconds...\");\n  await new Promise((r) => setTimeout(r, 3000));\n\n  const db = await introspect();\n  saveSnapshot(db);\n\n  console.log(\"Snapshot rebuilt.\");\n}\n\nexport async function validateSnapshot() {\n  const snapshot = loadSnapshot();\n  const actual = await introspect();\n  const actions = diff(snapshot, actual);\n\n  if (actions.length === 0) {\n    console.log(\"Snapshot is in sync with database.\");\n    return;\n  }\n\n  console.log(\"Snapshot is OUT OF SYNC:\");\n  console.log(JSON.stringify(actions, null, 2));\n}\n","import { DatabaseSchema, MigrationAction } from \"./schema-types\";\n\nfunction same(a: any, b: any) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction columnSimilarity(a: string, b: string): number {\n  const normalize = (s: string) => s.toLowerCase().replace(/[_-]/g, \"\");\n  const na = normalize(a);\n  const nb = normalize(b);\n\n  if (na === nb) return 1;\n\n  const longer = na.length > nb.length ? na : nb;\n  const shorter = na.length > nb.length ? nb : na;\n\n  if (longer.includes(shorter)) return 0.8;\n\n  let matches = 0;\n  for (let i = 0; i < shorter.length; i++) {\n    if (longer.includes(shorter[i])) matches++;\n  }\n  return matches / longer.length;\n}\n\nfunction detectRenames(\n  beforeCols: any[],\n  afterCols: any[],\n  getName: (x: any) => string\n): Map<string, string> {\n  const renames = new Map<string, string>();\n  const droppedCols = beforeCols.filter(\n    (b) => !afterCols.find((a) => getName(a) === getName(b))\n  );\n  const addedCols = afterCols.filter(\n    (a) => !beforeCols.find((b) => getName(b) === getName(a))\n  );\n\n  for (const dropped of droppedCols) {\n    let bestMatch = null;\n    let bestScore = 0.7;\n\n    for (const added of addedCols) {\n      if (renames.has(getName(added))) continue;\n\n      const score = columnSimilarity(getName(dropped), getName(added));\n      if (score > bestScore) {\n        bestScore = score;\n        bestMatch = added;\n      }\n    }\n\n    if (bestMatch) {\n      renames.set(getName(dropped), getName(bestMatch));\n    }\n  }\n\n  return renames;\n}\n\nfunction sortByDependencies(actions: MigrationAction[]): MigrationAction[] {\n  const createTables = actions.filter((a) => a.kind === \"createTable\");\n  const dropFKs = actions.filter((a) => a.kind === \"dropFK\");\n  const addFKs = actions.filter((a) => a.kind === \"addFK\");\n  const dropTables = actions.filter((a) => a.kind === \"dropTable\");\n  const rest = actions.filter(\n    (a) =>\n      a.kind !== \"createTable\" &&\n      a.kind !== \"dropFK\" &&\n      a.kind !== \"addFK\" &&\n      a.kind !== \"dropTable\"\n  );\n\n  return [...dropFKs, ...createTables, ...rest, ...addFKs, ...dropTables];\n}\n\nfunction getUniqueColumns(uniques: any[]): Set<string> {\n  const uniqueCols = new Set<string>();\n  uniques.forEach((u) => {\n    if (u.columns.length === 1) {\n      uniqueCols.add(u.columns[0]);\n    }\n  });\n  return uniqueCols;\n}\n\nfunction filterRedundantIndexes(indexes: any[], uniques: any[]): any[] {\n  const uniqueCols = getUniqueColumns(uniques);\n\n  return indexes.filter((idx) => {\n    if (idx.unique) return false;\n\n    if (idx.columns.length === 1 && uniqueCols.has(idx.columns[0])) {\n      return false;\n    }\n\n    return true;\n  });\n}\n\nexport function diff(\n  before: DatabaseSchema,\n  after: DatabaseSchema\n): MigrationAction[] {\n  const out: MigrationAction[] = [];\n\n  after.tables.forEach((t) => {\n    if (!before.tables.find((x) => x.name === t.name)) {\n      out.push({ kind: \"createTable\", table: t });\n    }\n  });\n\n  before.tables.forEach((t) => {\n    if (!after.tables.find((x) => x.name === t.name)) {\n      out.push({ kind: \"dropTable\", tableName: t.name, backup: t });\n    }\n  });\n\n  after.tables.forEach((t) => {\n    const prev = before.tables.find((x) => x.name === t.name);\n    if (!prev) return;\n\n    const colRenames = detectRenames(prev.columns, t.columns, (c) => c.name);\n\n    colRenames.forEach((newName, oldName) => {\n      out.push({\n        kind: \"renameColumn\",\n        tableName: t.name,\n        oldName,\n        newName,\n      });\n    });\n\n    t.columns.forEach((c) => {\n      const p = prev.columns.find((x) => x.name === c.name);\n      const renamedFrom = Array.from(colRenames.entries()).find(\n        ([_, newN]) => newN === c.name\n      );\n\n      if (renamedFrom) {\n        const oldCol = prev.columns.find((x) => x.name === renamedFrom[0]);\n        if (oldCol && !same(oldCol, { ...c, name: oldCol.name })) {\n          out.push({\n            kind: \"alterColumn\",\n            tableName: t.name,\n            before: oldCol,\n            after: c,\n          });\n        }\n      } else if (!p) {\n        out.push({ kind: \"addColumn\", tableName: t.name, column: c });\n      } else if (!same(p, c)) {\n        out.push({\n          kind: \"alterColumn\",\n          tableName: t.name,\n          before: p,\n          after: c,\n        });\n      }\n    });\n\n    prev.columns.forEach((c) => {\n      const isRenamed = colRenames.has(c.name);\n      if (!t.columns.find((x) => x.name === c.name) && !isRenamed) {\n        out.push({\n          kind: \"dropColumn\",\n          tableName: t.name,\n          columnName: c.name,\n          backup: c,\n        });\n      }\n    });\n\n    if (!same(prev.primaryKeys, t.primaryKeys)) {\n      out.push({\n        kind: \"changePrimaryKey\",\n        tableName: t.name,\n        before: prev.primaryKeys,\n        after: t.primaryKeys,\n      });\n    }\n\n    const filteredPrevIndexes = filterRedundantIndexes(\n      prev.indexes,\n      prev.uniques\n    );\n    const filteredAfterIndexes = filterRedundantIndexes(t.indexes, t.uniques);\n\n    filteredAfterIndexes.forEach((i) => {\n      const p = filteredPrevIndexes.find((x) => x.name === i.name);\n      if (!p) out.push({ kind: \"createIndex\", tableName: t.name, index: i });\n      else if (!same(p, i)) {\n        out.push({\n          kind: \"dropIndex\",\n          tableName: t.name,\n          indexName: i.name,\n          backup: p,\n        });\n        out.push({ kind: \"createIndex\", tableName: t.name, index: i });\n      }\n    });\n\n    filteredPrevIndexes.forEach((i) => {\n      if (!filteredAfterIndexes.find((x) => x.name === i.name)) {\n        out.push({\n          kind: \"dropIndex\",\n          tableName: t.name,\n          indexName: i.name,\n          backup: i,\n        });\n      }\n    });\n\n    t.foreignKeys.forEach((fk) => {\n      const p = prev.foreignKeys.find((x) => x.name === fk.name);\n      if (!p) out.push({ kind: \"addFK\", tableName: t.name, fk });\n      else if (!same(p, fk)) {\n        out.push({\n          kind: \"dropFK\",\n          tableName: t.name,\n          fkName: p.name,\n          backup: p,\n        });\n        out.push({ kind: \"addFK\", tableName: t.name, fk });\n      }\n    });\n\n    prev.foreignKeys.forEach((fk) => {\n      if (!t.foreignKeys.find((x) => x.name === fk.name)) {\n        out.push({\n          kind: \"dropFK\",\n          tableName: t.name,\n          fkName: fk.name,\n          backup: fk,\n        });\n      }\n    });\n\n    const beforeUnique = prev.uniques || [];\n    const afterUnique = t.uniques || [];\n\n    afterUnique.forEach((u) => {\n      const old = beforeUnique.find((x) => x.name === u.name);\n      if (!old) out.push({ kind: \"addUnique\", tableName: t.name, unique: u });\n      else if (!same(old.columns, u.columns)) {\n        out.push({\n          kind: \"dropUnique\",\n          tableName: t.name,\n          uniqueName: old.name,\n          backup: old,\n        });\n        out.push({ kind: \"addUnique\", tableName: t.name, unique: u });\n      }\n    });\n\n    beforeUnique.forEach((u) => {\n      if (!afterUnique.find((x) => x.name === u.name)) {\n        out.push({\n          kind: \"dropUnique\",\n          tableName: t.name,\n          uniqueName: u.name,\n          backup: u,\n        });\n      }\n    });\n\n    const beforeChecks = prev.checks || [];\n    const afterChecks = t.checks || [];\n\n    afterChecks.forEach((ch) => {\n      const old = beforeChecks.find((x) => x.name === ch.name);\n      if (!old) out.push({ kind: \"addCheck\", tableName: t.name, check: ch });\n      else if (!same(old, ch)) {\n        out.push({\n          kind: \"dropCheck\",\n          tableName: t.name,\n          checkName: old.name,\n          backup: old,\n        });\n        out.push({ kind: \"addCheck\", tableName: t.name, check: ch });\n      }\n    });\n\n    beforeChecks.forEach((ch) => {\n      if (!afterChecks.find((x) => x.name === ch.name)) {\n        out.push({\n          kind: \"dropCheck\",\n          tableName: t.name,\n          checkName: ch.name,\n          backup: ch,\n        });\n      }\n    });\n  });\n\n  return sortByDependencies(out);\n}\n","import fs from \"fs\";\nimport path from \"path\";\nimport { MigrationAction } from \"./schema-types\";\n\nfunction mapType(dbType: string, enumValues?: string[]) {\n  const upper = dbType.toUpperCase();\n\n  if (upper.includes(\"[]\") || upper.includes(\"ARRAY\")) {\n    let innerType = \"Sequelize.STRING\";\n\n    const bracketMatch = dbType.match(/^([A-Z]+)(?:\\([^)]+\\))?\\[\\]/i);\n    const arrayMatch = dbType.match(/ARRAY\\((.*?)\\)/i);\n\n    if (bracketMatch) {\n      const baseType = bracketMatch[1].toUpperCase();\n      if (baseType.includes(\"INT\")) innerType = \"Sequelize.INTEGER\";\n      else if (baseType.includes(\"BIGINT\")) innerType = \"Sequelize.BIGINT\";\n      else if (baseType.includes(\"TEXT\")) innerType = \"Sequelize.TEXT\";\n      else if (baseType.includes(\"BOOLEAN\")) innerType = \"Sequelize.BOOLEAN\";\n      else if (baseType.includes(\"DATE\") || baseType.includes(\"TIMESTAMP\"))\n        innerType = \"Sequelize.DATE\";\n      else if (baseType.includes(\"UUID\")) innerType = \"Sequelize.UUID\";\n      else if (baseType.includes(\"JSON\")) innerType = \"Sequelize.JSON\";\n      else if (baseType.includes(\"JSONB\")) innerType = \"Sequelize.JSONB\";\n      else if (baseType.includes(\"DECIMAL\")) innerType = \"Sequelize.DECIMAL\";\n      else if (baseType.includes(\"FLOAT\") || baseType.includes(\"REAL\"))\n        innerType = \"Sequelize.FLOAT\";\n      else innerType = \"Sequelize.STRING\";\n    } else if (arrayMatch) {\n      const baseType = arrayMatch[1].toUpperCase();\n      if (baseType.includes(\"INT\")) innerType = \"Sequelize.INTEGER\";\n      else if (baseType.includes(\"BIGINT\")) innerType = \"Sequelize.BIGINT\";\n      else if (baseType.includes(\"TEXT\")) innerType = \"Sequelize.TEXT\";\n      else if (baseType.includes(\"BOOLEAN\")) innerType = \"Sequelize.BOOLEAN\";\n      else if (baseType.includes(\"DATE\") || baseType.includes(\"TIMESTAMP\"))\n        innerType = \"Sequelize.DATE\";\n      else if (baseType.includes(\"UUID\")) innerType = \"Sequelize.UUID\";\n      else if (baseType.includes(\"JSON\")) innerType = \"Sequelize.JSON\";\n      else if (baseType.includes(\"JSONB\")) innerType = \"Sequelize.JSONB\";\n      else if (baseType.includes(\"DECIMAL\")) innerType = \"Sequelize.DECIMAL\";\n      else if (baseType.includes(\"FLOAT\") || baseType.includes(\"REAL\"))\n        innerType = \"Sequelize.FLOAT\";\n      else innerType = \"Sequelize.STRING\";\n    }\n\n    return `Sequelize.ARRAY(${innerType})`;\n  }\n\n  if (upper.startsWith(\"ENUM\") || upper.includes(\"ENUM(\") || enumValues) {\n    if (enumValues && enumValues.length > 0) {\n      return `Sequelize.ENUM(${enumValues.map((v) => `\"${v}\"`).join(\", \")})`;\n    }\n    const startIdx = dbType.indexOf(\"(\");\n    const endIdx = dbType.lastIndexOf(\")\");\n    if (startIdx !== -1 && endIdx !== -1) {\n      const inner = dbType.slice(startIdx + 1, endIdx);\n      const values = inner\n        .split(\",\")\n        .map((v) => v.trim().replace(/^[\"']+|[\"']+$/g, \"\"));\n      return `Sequelize.ENUM(${values.map((v) => `\"${v}\"`).join(\", \")})`;\n    }\n  }\n\n  if (upper.includes(\"TIMESTAMP\") || upper.includes(\"DATE\"))\n    return \"Sequelize.DATE\";\n  if (upper.includes(\"UUID\")) return \"Sequelize.UUID\";\n  if (upper.includes(\"BIGINT\")) return \"Sequelize.BIGINT\";\n  if (upper.includes(\"INT\")) return \"Sequelize.INTEGER\";\n  if (upper.includes(\"TEXT\")) return \"Sequelize.TEXT\";\n  if (upper.includes(\"CHAR\") || upper.includes(\"STRING\"))\n    return \"Sequelize.STRING\";\n  if (upper.includes(\"BOOLEAN\")) return \"Sequelize.BOOLEAN\";\n  if (upper.includes(\"JSONB\")) return \"Sequelize.JSONB\";\n  if (upper.includes(\"JSON\")) return \"Sequelize.JSON\";\n  if (upper.includes(\"DECIMAL\")) return \"Sequelize.DECIMAL\";\n  if (upper.includes(\"FLOAT\") || upper.includes(\"REAL\"))\n    return \"Sequelize.FLOAT\";\n\n  return \"Sequelize.STRING\";\n}\n\nfunction col(c: any) {\n  const parts: string[] = [];\n\n  parts.push(`type: ${mapType(c.dbType, c.enumValues)}`);\n\n  parts.push(`allowNull: ${c.allowNull}`);\n\n  parts.push(`primaryKey: ${c.primaryKey}`);\n\n  parts.push(`unique: ${c.unique}`);\n\n  if (c.hasOwnProperty(\"defaultValue\")) {\n    let defaultValue = \"null\";\n\n    if (c.defaultValue === \"NOW\") {\n      defaultValue = 'Sequelize.fn(\"NOW\")';\n    } else if (c.defaultValue === \"UUID_FUNCTION\") {\n      defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n    } else if (c.defaultValue !== null && c.defaultValue !== undefined) {\n      const defaultStr = String(c.defaultValue);\n\n      if (\n        typeof c.defaultValue === \"function\" ||\n        defaultStr === \"[Function]\" ||\n        defaultStr.includes(\"function\")\n      ) {\n        if (\n          c.name === \"id\" &&\n          (c.type === \"UUID\" || c.dbType?.includes(\"UUID\"))\n        ) {\n          defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n        } else {\n          defaultValue = \"Sequelize.UUIDV4\";\n        }\n      } else if (Array.isArray(c.defaultValue)) {\n        defaultValue = JSON.stringify(c.defaultValue);\n      } else {\n        defaultValue = JSON.stringify(c.defaultValue);\n      }\n    } else if (\n      c.name === \"id\" &&\n      c.primaryKey &&\n      (c.type === \"UUID\" || c.dbType?.includes(\"UUID\"))\n    ) {\n      defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n    }\n\n    parts.push(`defaultValue: ${defaultValue}`);\n  }\n\n  return `{\n    ${parts.join(\",\\n    \")}\n  }`;\n}\n\nexport function generate(actions: MigrationAction[]): string | null {\n  if (!actions.length) return null;\n\n  const ts = new Date().toISOString().replace(/[:.]/g, \"-\");\n  const name = `${ts}-auto-migration.cjs`;\n  const dir = path.join(process.cwd(), \"src/migrations\");\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n\n  const createTables: string[] = [];\n  const addConstraints: string[] = [];\n  const addIndexes: string[] = [];\n  const otherUp: string[] = [];\n\n  const dropConstraints: string[] = [];\n  const dropTables: string[] = [];\n  const otherDown: string[] = [];\n\n  actions.forEach((a) => {\n    if (a.kind === \"createTable\") {\n      const columns = a.table.columns\n        .map((c) => `\"${c.name}\": ${col(c)}`)\n        .join(\",\\n      \");\n\n      createTables.push(`await queryInterface.createTable(\"${a.table.name}\", {\n      ${columns}\n    });`);\n\n      a.table.foreignKeys.forEach((fk) => {\n        addConstraints.push(`await queryInterface.addConstraint(\"${\n          a.table.name\n        }\", {\n      type: \"foreign key\",\n      fields: [\"${fk.column}\"],\n      name: \"${fk.name}\",\n      references: { table: \"${fk.referencedTable}\", field: \"${\n          fk.referencedColumn\n        }\" },\n      onDelete: ${fk.onDelete ? `\"${fk.onDelete}\"` : \"null\"},\n      onUpdate: ${fk.onUpdate ? `\"${fk.onUpdate}\"` : \"null\"}\n    });`);\n\n        dropConstraints.push(\n          `await queryInterface.removeConstraint(\"${a.table.name}\", \"${fk.name}\");`\n        );\n      });\n\n      a.table.uniques.forEach((u) => {\n        addConstraints.push(`await queryInterface.addConstraint(\"${\n          a.table.name\n        }\", {\n      type: \"unique\",\n      name: \"${u.name}\",\n      fields: ${JSON.stringify(u.columns)}\n    });`);\n\n        dropConstraints.push(\n          `await queryInterface.removeConstraint(\"${a.table.name}\", \"${u.name}\");`\n        );\n      });\n\n      a.table.indexes.forEach((idx) => {\n        if (!idx.unique) {\n          const options: any = {\n            name: idx.name,\n            unique: idx.unique,\n          };\n          if (idx.where) options.where = idx.where;\n\n          addIndexes.push(\n            `await queryInterface.addIndex(\"${a.table.name}\", ${JSON.stringify(\n              idx.columns\n            )}, ${JSON.stringify(options)});`\n          );\n        }\n      });\n\n      dropTables.push(`await queryInterface.dropTable(\"${a.table.name}\");`);\n    }\n\n    if (a.kind === \"dropTable\") {\n      otherUp.push(`await queryInterface.dropTable(\"${a.tableName}\");`);\n    }\n\n    if (a.kind === \"addColumn\") {\n      otherUp.push(\n        `await queryInterface.addColumn(\"${a.tableName}\", \"${\n          a.column.name\n        }\", ${col(a.column)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.removeColumn(\"${a.tableName}\", \"${a.column.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropColumn\") {\n      otherUp.push(\n        `await queryInterface.removeColumn(\"${a.tableName}\", \"${a.columnName}\");`\n      );\n    }\n\n    if (a.kind === \"alterColumn\") {\n      otherUp.push(\n        `await queryInterface.changeColumn(\"${a.tableName}\", \"${\n          a.after.name\n        }\", ${col(a.after)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.changeColumn(\"${a.tableName}\", \"${\n          a.before.name\n        }\", ${col(a.before)});`\n      );\n    }\n\n    if (a.kind === \"createIndex\") {\n      const options: any = {\n        name: a.index.name,\n        unique: a.index.unique,\n      };\n      if (a.index.where) options.where = a.index.where;\n\n      otherUp.push(\n        `await queryInterface.addIndex(\"${a.tableName}\", ${JSON.stringify(\n          a.index.columns\n        )}, ${JSON.stringify(options)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.removeIndex(\"${a.tableName}\", \"${a.index.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropIndex\") {\n      otherUp.push(\n        `await queryInterface.removeIndex(\"${a.tableName}\", \"${a.indexName}\");`\n      );\n    }\n\n    if (a.kind === \"addFK\") {\n      otherUp.push(`await queryInterface.addConstraint(\"${a.tableName}\", {\n  type: \"foreign key\",\n  fields: [\"${a.fk.column}\"],\n  name: \"${a.fk.name}\",\n  references: { table: \"${a.fk.referencedTable}\", field: \"${\n        a.fk.referencedColumn\n      }\" },\n  onDelete: ${a.fk.onDelete ? `\"${a.fk.onDelete}\"` : \"null\"},\n  onUpdate: ${a.fk.onUpdate ? `\"${a.fk.onUpdate}\"` : \"null\"}\n});`);\n\n      otherDown.unshift(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.fk.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropFK\") {\n      otherUp.push(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.fkName}\");`\n      );\n    }\n\n    if (a.kind === \"addUnique\") {\n      otherUp.push(`await queryInterface.addConstraint(\"${a.tableName}\", {\n  type: \"unique\",\n  name: \"${a.unique.name}\",\n  fields: ${JSON.stringify(a.unique.columns)}\n});`);\n      otherDown.unshift(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.unique.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropUnique\") {\n      otherUp.push(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.uniqueName}\");`\n      );\n    }\n  });\n\n  const up = [\n    ...createTables,\n    ...addConstraints,\n    ...addIndexes,\n    ...otherUp,\n  ].filter(Boolean);\n\n  const down = [...dropConstraints, ...dropTables, ...otherDown].filter(\n    Boolean\n  );\n\n  const content = `\n\"use strict\";\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    const transaction = await queryInterface.sequelize.transaction();\n    try {\n      ${up.length ? up.join(\"\\n      \") : \"\"}\n      await transaction.commit();\n    } catch (error) {\n      await transaction.rollback();\n      throw error;\n    }\n  },\n  async down(queryInterface, Sequelize) {\n    const transaction = await queryInterface.sequelize.transaction();\n    try {\n      ${down.length ? down.join(\"\\n      \") : \"\"}\n      await transaction.commit();\n    } catch (error) {\n      await transaction.rollback();\n      throw error;\n    }\n  },\n};\n`;\n\n  const file = path.join(dir, name);\n  fs.writeFileSync(file, content);\n  return file;\n}\n","import fs from \"fs\";\nimport path from \"path\";\nimport { loadSeqmigConfig } from \"src/loaders/config-loader\";\nimport { DatabaseSchema } from \"./schema-types\";\n\nexport function getSnapshotPaths() {\n  const cfg = loadSeqmigConfig();\n\n  const snapshotDir = cfg.snapshotDir || \".seqmig/snapshots\";\n  const migrationDir = cfg.migrationDir || \"migrations\";\n\n  const SNAPSHOT_FILE = path.join(\n    process.cwd(),\n    snapshotDir,\n    \"schema-snapshot.json\"\n  );\n  const SNAPSHOT_BACKUP_DIR = path.join(process.cwd(), snapshotDir, \"backups\");\n\n  return { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR, migrationDir, snapshotDir };\n}\n\nexport function loadSnapshot(): DatabaseSchema {\n  const { SNAPSHOT_FILE } = getSnapshotPaths();\n\n  if (!fs.existsSync(SNAPSHOT_FILE)) {\n    return { tables: [] };\n  }\n\n  const raw = fs.readFileSync(SNAPSHOT_FILE, \"utf8\");\n  return JSON.parse(raw) as DatabaseSchema;\n}\n\nexport function saveSnapshot(schema: DatabaseSchema) {\n  const { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n  const dir = path.dirname(SNAPSHOT_FILE);\n\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n  if (!fs.existsSync(SNAPSHOT_BACKUP_DIR))\n    fs.mkdirSync(SNAPSHOT_BACKUP_DIR, { recursive: true });\n\n  if (fs.existsSync(SNAPSHOT_FILE)) {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \"-\");\n    const backupFile = path.join(\n      SNAPSHOT_BACKUP_DIR,\n      `snapshot-${timestamp}.json`\n    );\n    fs.copyFileSync(SNAPSHOT_FILE, backupFile);\n    cleanOldBackups(SNAPSHOT_BACKUP_DIR, 20);\n  }\n\n  fs.writeFileSync(SNAPSHOT_FILE, JSON.stringify(schema, null, 2));\n}\n\nfunction cleanOldBackups(backupDir: string, keepCount: number) {\n  const backups = fs\n    .readdirSync(backupDir)\n    .filter((f) => f.startsWith(\"snapshot-\"))\n    .sort()\n    .reverse();\n\n  backups.slice(keepCount).forEach((file) => {\n    fs.unlinkSync(path.join(backupDir, file));\n  });\n}\n\nexport function listBackups(): string[] {\n  const { SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n  if (!fs.existsSync(SNAPSHOT_BACKUP_DIR)) return [];\n  return fs\n    .readdirSync(SNAPSHOT_BACKUP_DIR)\n    .filter((f) => f.startsWith(\"snapshot-\"))\n    .sort()\n    .reverse();\n}\n\nexport function restoreBackup(backupFile: string) {\n  const { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n\n  const backupPath = path.join(SNAPSHOT_BACKUP_DIR, backupFile);\n  if (!fs.existsSync(backupPath)) {\n    throw new Error(`Backup file not found: ${backupFile}`);\n  }\n\n  fs.copyFileSync(backupPath, SNAPSHOT_FILE);\n  console.log(`Restored snapshot from ${backupFile}`);\n}\n"],"mappings":"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","names":["loadSeqmigConfig","rcPath","path","join","process","cwd","rc","fs","existsSync","require","resolve","p","fallback","isAbsolute","configFile","config","modelsPath","migrationDir","seedersPath","snapshotDir","url","debug","tsconfigPath","loadSequelizeConfig","cfg","dialect","logging","configPath","Error","cache","env","NODE_ENV","db","username","database","host","String","password","port","Number","initConfig","console","log","template","trimStart","writeFileSync","import_fs","import_path","registerRuntime","require","e","console","warn","toScalar","db","t","toUpperCase","includes","startsWith","extractEnumValues","dbType","upper","undefined","startIdx","indexOf","endIdx","lastIndexOf","inner","slice","split","map","v","trim","replace","isManyToManyJoinTable","tableName","columns","foreignKeys","indexes","length","fkColumns","fk","column","hasCompositeUnique","some","idx","unique","fkInIndex","filter","col","getAllModelFiles","dir","files","fs","existsSync","Error","items","readdirSync","item","fullPath","path","join","stat","statSync","isDirectory","push","endsWith","introspect","cfg","loadSequelizeConfig","seqmigConfig","loadSeqmigConfig","sequelize","Sequelize","logging","import","filePath","modelsPath","isAbsolute","process","cwd","modelFiles","modelClasses","file","mod","modelClass","default","Object","values","addModels","authenticate","schema","tables","models","modelName","m","entries","String","getTableName","attrs","getAttributes","name","a","raw","type","toString","isArray","key","isEnum","Array","enumValues","defaultValue","hasDefault","defaultStr","beforeTypeCast","allowNull","primaryKey","autoIncrement","comment","primaryKeys","c","rawIndexes","options","fields","where","using","uniques","uniqueColumnNames","Set","uniqueNameToColumns","Map","forEach","attr","uniqueValue","uniqueName","has","set","get","add","cols","uniqueKeys","isDuplicate","u","JSON","stringify","sort","field","colName","find","checks","validate","expr","expression","associations","assoc","associationType","foreignKey","constraintName","referencedTable","target","referencedColumn","primaryKeyAttribute","onDelete","onUpdate","isJoinTable","mainFKs","hasUniqueConstraint","sortedU","sortedFK","every","i","fkCol","same","a","b","JSON","stringify","columnSimilarity","normalize","s","toLowerCase","replace","na","nb","longer","length","shorter","includes","matches","i","detectRenames","beforeCols","afterCols","getName","renames","Map","droppedCols","filter","find","addedCols","dropped","bestMatch","bestScore","added","has","score","set","sortByDependencies","actions","createTables","kind","dropFKs","addFKs","dropTables","rest","getUniqueColumns","uniques","uniqueCols","Set","forEach","u","columns","add","filterRedundantIndexes","indexes","idx","unique","diff","before","after","out","tables","t","x","name","push","table","tableName","backup","prev","colRenames","c","newName","oldName","p","renamedFrom","Array","from","entries","_","newN","oldCol","column","isRenamed","columnName","primaryKeys","filteredPrevIndexes","filteredAfterIndexes","index","indexName","foreignKeys","fk","fkName","beforeUnique","afterUnique","old","uniqueName","beforeChecks","checks","afterChecks","ch","check","checkName","import_fs","import_path","mapType","dbType","enumValues","upper","toUpperCase","includes","innerType","bracketMatch","match","arrayMatch","baseType","startsWith","length","map","v","join","startIdx","indexOf","endIdx","lastIndexOf","inner","slice","values","split","trim","replace","col","c","parts","push","allowNull","primaryKey","unique","hasOwnProperty","defaultValue","undefined","defaultStr","String","name","type","Array","isArray","JSON","stringify","generate","actions","ts","Date","toISOString","dir","path","process","cwd","fs","existsSync","mkdirSync","recursive","createTables","addConstraints","addIndexes","otherUp","dropConstraints","dropTables","otherDown","forEach","a","kind","columns","table","foreignKeys","fk","column","referencedTable","referencedColumn","onDelete","onUpdate","uniques","u","indexes","idx","options","where","tableName","unshift","columnName","after","before","index","indexName","fkName","uniqueName","up","filter","Boolean","down","content","file","writeFileSync","import_fs","import_path","getSnapshotPaths","cfg","loadSeqmigConfig","snapshotDir","migrationDir","SNAPSHOT_FILE","path","join","process","cwd","SNAPSHOT_BACKUP_DIR","loadSnapshot","fs","existsSync","tables","raw","readFileSync","JSON","parse","saveSnapshot","schema","dir","dirname","mkdirSync","recursive","timestamp","Date","toISOString","replace","backupFile","copyFileSync","cleanOldBackups","writeFileSync","stringify","backupDir","keepCount","backups","readdirSync","filter","f","startsWith","sort","reverse","slice","forEach","file","unlinkSync","listBackups","restoreBackup","backupPath","Error","console","log","preview","before","loadSnapshot","after","introspect","actions","diff","console","log","JSON","stringify","generateMigration","length","file","generate","saveSnapshot","runMigrations","execa","stdio","rollbackLast","rebuildSnapshot","Promise","r","setTimeout","db","validateSnapshot","snapshot","actual","wrap","fn","args","err","console","error","process","exit","runCli","program","Command","name","description","version","command","action","initConfig","preview","generateMigration","runMigrations","rollbackLast","rebuildSnapshot","validateSnapshot","backups","listBackups","length","log","forEach","b","i","backup","restoreBackup","result","introspect","JSON","stringify","parseAsync","argv","require","main","module"]}