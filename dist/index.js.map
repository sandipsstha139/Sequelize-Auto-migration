{"version":3,"sources":["../src/index.ts","../package.json","../src/services/introspect.ts","../src/utils/load-config.ts","../src/utils/load-seqmig.ts","../src/services/migrate.ts","../src/services/diff.ts","../src/services/generator.ts","../src/services/state.ts","../src/debug.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { Command } from \"commander\";\nimport { version } from \"../package.json\";\nimport { introspect } from \"./services/introspect\";\nimport {\n  generateMigration,\n  preview,\n  rebuildSnapshot,\n  rollbackLast,\n  runMigrations,\n  validateSnapshot,\n} from \"./services/migrate\";\nimport { listBackups, restoreBackup } from \"./services/state\";\n\nfunction wrap(fn: (...args: any[]) => Promise<any>) {\n  return async (...args: any[]) => {\n    try {\n      await fn(...args);\n    } catch (err) {\n      console.error(\"Error:\", err);\n      process.exit(1);\n    }\n  };\n}\n\nexport async function runCli() {\n  const program = new Command();\n\n  program\n    .name(\"seqmig\")\n    .description(\"Sequelize auto-migration CLI\")\n    .version(version);\n\n  program\n    .command(\"preview\")\n    .description(\"Preview schema diff\")\n    .action(wrap(preview));\n\n  program\n    .command(\"generate\")\n    .description(\"Generate migration file\")\n    .action(wrap(generateMigration));\n\n  program\n    .command(\"run\")\n    .description(\"Run pending migrations\")\n    .action(wrap(runMigrations));\n\n  program\n    .command(\"rollback\")\n    .description(\"Rollback last migration\")\n    .action(wrap(rollbackLast));\n\n  program\n    .command(\"rebuild\")\n    .description(\"Rebuild snapshot\")\n    .action(wrap(rebuildSnapshot));\n\n  program\n    .command(\"validate\")\n    .description(\"Validate snapshot\")\n    .action(wrap(validateSnapshot));\n\n  program\n    .command(\"backups\")\n    .description(\"List snapshot backups\")\n    .action(() => {\n      const backups = listBackups();\n      if (backups.length === 0) {\n        console.log(\"No backups found.\");\n        return;\n      }\n      console.log(\"Available backups:\");\n      backups.forEach((b, i) => console.log(`${i + 1}. ${b}`));\n    });\n\n  program\n    .command(\"restore <backup>\")\n    .description(\"Restore snapshot\")\n    .action((backup: string) => {\n      restoreBackup(backup);\n    });\n\n  program\n    .command(\"introspect\")\n    .description(\"Introspect DB schema\")\n    .option(\"-c, --config <path>\", \"Path to sequelize config file\")\n    .action(\n      wrap(async (opts) => {\n        const result = await introspect(opts.config);\n        console.log(result);\n      })\n    );\n\n  await program.parseAsync(process.argv);\n}\n\nif (require.main === module) {\n  runCli();\n}\n\nexport { debugConfig } from \"./debug\";\n","{\n  \"name\": \"seqmig\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Sequelize auto-migration CLI\",\n  \"main\": \"dist/index.js\",\n  \"bin\": {\n    \"seqmig\": \"dist/index.js\"\n  },\n  \"scripts\": {\n    \"build\": \"tsup\",\n    \"version-packages\": \"changeset version\",\n    \"release\": \"changeset publish\",\n    \"changeset\": \"changeset\"\n  },\n  \"keywords\": [\n    \"sequelize\",\n    \"migration\",\n    \"auto-migration\",\n    \"cli\",\n    \"database\"\n  ],\n  \"author\": \"Sandip Shrestha <sandipstha139@gmail.com>\",\n  \"license\": \"ISC\",\n  \"packageManager\": \"pnpm@10.14.0\",\n  \"dependencies\": {\n    \"commander\": \"^14.0.2\",\n    \"execa\": \"^9.6.1\",\n    \"pg\": \"^8.16.3\",\n    \"sequelize\": \"^6.37.7\",\n    \"sequelize-cli\": \"^6.6.3\",\n    \"sequelize-typescript\": \"^2.1.6\",\n    \"tsx\": \"^4.21.0\",\n    \"yaml\": \"^2.8.2\"\n  },\n  \"devDependencies\": {\n    \"@changesets/cli\": \"^2.29.8\",\n    \"@types/node\": \"^24.10.1\",\n    \"tsup\": \"^8.5.1\",\n    \"typescript\": \"^5.9.3\"\n  }\n}\n","import { Model, ModelCtor, Sequelize } from \"sequelize-typescript\";\nimport { loadUserSequelizeConfig } from \"src/utils/load-config\";\nimport {\n  CheckConstraintSchema,\n  ColumnSchema,\n  DatabaseSchema,\n  ForeignKeySchema,\n  IndexSchema,\n  UniqueConstraintSchema,\n} from \"./schema-types\";\n\nfunction toScalar(db: string): any {\n  const t = db.toUpperCase();\n  if (t.includes(\"ARRAY\")) return \"ARRAY\";\n  if (t.startsWith(\"ENUM\") || t.includes(\"ENUM(\")) return \"ENUM\";\n  if (t.includes(\"UUID\")) return \"UUID\";\n  if (t.includes(\"TIMESTAMP\") || t.includes(\"DATE\")) return \"DATE\";\n  if (t.includes(\"BIGINT\")) return \"BIGINT\";\n  if (t.includes(\"INT\")) return \"INTEGER\";\n  if (t.includes(\"TEXT\")) return \"TEXT\";\n  if (t.includes(\"CHAR\") || t.includes(\"STRING\")) return \"STRING\";\n  if (t.includes(\"BOOLEAN\")) return \"BOOLEAN\";\n  if (t.includes(\"JSONB\")) return \"JSONB\";\n  if (t.includes(\"JSON\")) return \"JSON\";\n  if (t.includes(\"DECIMAL\")) return \"DECIMAL\";\n  if (t.includes(\"FLOAT\")) return \"FLOAT\";\n  return \"STRING\";\n}\n\nfunction extractEnumValues(dbType: string): string[] | undefined {\n  const upper = dbType.toUpperCase();\n  if (!upper.startsWith(\"ENUM\") && !upper.includes(\"ENUM(\")) return undefined;\n\n  const startIdx = dbType.indexOf(\"(\");\n  const endIdx = dbType.lastIndexOf(\")\");\n\n  if (startIdx === -1 || endIdx === -1) return undefined;\n\n  const inner = dbType.slice(startIdx + 1, endIdx);\n  return inner.split(\",\").map((v) => v.trim().replace(/^[\"']+|[\"']+$/g, \"\"));\n}\n\nfunction isManyToManyJoinTable(\n  tableName: string,\n  columns: ColumnSchema[],\n  foreignKeys: ForeignKeySchema[],\n  indexes: IndexSchema[]\n): boolean {\n  if (foreignKeys.length < 2) return false;\n  const fkColumns = foreignKeys.map((fk) => fk.column);\n  const hasCompositeUnique = indexes.some((idx) => {\n    if (!idx.unique) return false;\n    const fkInIndex = idx.columns.filter((col) => fkColumns.includes(col));\n    return fkInIndex.length >= 2;\n  });\n  return hasCompositeUnique;\n}\n\nexport async function introspect(configPath?: string): Promise<DatabaseSchema> {\n  const cfg = await loadUserSequelizeConfig();\n\n  const sequelize = new Sequelize({\n    ...cfg,\n    logging: false,\n  });\n\n  await sequelize.authenticate();\n  const schema: DatabaseSchema = { tables: [] };\n  const models = sequelize.modelManager.models as ModelCtor<Model>[];\n\n  for (const m of models) {\n    const tableName = String(m.getTableName());\n    const attrs = m.getAttributes();\n\n    const columns: ColumnSchema[] = Object.entries(attrs).map(\n      ([name, a]: any) => {\n        const raw = a.type?.toString() || \"STRING\";\n\n        const isArray =\n          raw.toUpperCase().includes(\"ARRAY\") ||\n          (a.type && a.type.key === \"ARRAY\") ||\n          (a.type && a.type.constructor && a.type.constructor.name === \"ARRAY\");\n\n        const isEnum =\n          raw.toUpperCase().includes(\"ENUM\") ||\n          (a.type && a.type.key === \"ENUM\") ||\n          (a.type &&\n            a.type.constructor &&\n            a.type.constructor.name === \"ENUM\") ||\n          (a.type && a.type.values && Array.isArray(a.type.values));\n\n        let enumValues: string[] | undefined;\n        if (isEnum) {\n          if (a.type && a.type.values && Array.isArray(a.type.values)) {\n            enumValues = a.type.values;\n          } else {\n            enumValues = extractEnumValues(raw);\n          }\n        }\n\n        let defaultValue = a.defaultValue;\n        let hasDefault = false;\n\n        if (defaultValue !== null && defaultValue !== undefined) {\n          const defaultStr = String(defaultValue);\n\n          if (defaultStr.includes(\"::\")) {\n            const beforeTypeCast = defaultStr.split(\"::\")[0].trim();\n\n            if (\n              beforeTypeCast.toUpperCase() === \"NULL\" ||\n              beforeTypeCast === \"\"\n            ) {\n              defaultValue = null;\n              hasDefault = false;\n            } else {\n              defaultValue = beforeTypeCast.replace(/^'(.*)'$/, \"$1\");\n              hasDefault = true;\n            }\n          } else if (defaultStr === \"undefined\") {\n            defaultValue = null;\n            hasDefault = false;\n          } else if (\n            typeof defaultValue === \"function\" ||\n            defaultStr === \"[Function]\" ||\n            defaultStr.includes(\"function\") ||\n            defaultStr.includes(\"now()\")\n          ) {\n            if (\n              (name === \"createdAt\" || name === \"updatedAt\") &&\n              (raw.toUpperCase().includes(\"DATE\") ||\n                raw.toUpperCase().includes(\"TIMESTAMP\"))\n            ) {\n              hasDefault = true;\n              defaultValue = \"NOW\";\n            } else if (name === \"id\" && raw.toUpperCase().includes(\"UUID\")) {\n              hasDefault = true;\n              defaultValue = \"UUID_FUNCTION\";\n            } else {\n              defaultValue = null;\n              hasDefault = false;\n            }\n          } else {\n            hasDefault = true;\n          }\n        }\n\n        if (!hasDefault && (name === \"createdAt\" || name === \"updatedAt\")) {\n          if (\n            raw.toUpperCase().includes(\"DATE\") ||\n            raw.toUpperCase().includes(\"TIMESTAMP\")\n          ) {\n            hasDefault = true;\n            defaultValue = \"NOW\";\n          }\n        }\n\n        if (defaultValue === undefined) {\n          defaultValue = null;\n          hasDefault = false;\n        }\n\n        const allowNull = a.allowNull === false ? false : true;\n\n        const column: any = {\n          name,\n          type: isArray ? \"ARRAY\" : isEnum ? \"ENUM\" : toScalar(raw),\n          dbType: raw,\n          allowNull: allowNull,\n          primaryKey: !!a.primaryKey,\n          unique:\n            !!a.unique || a.unique === true || typeof a.unique === \"string\",\n          autoIncrement: !!a.autoIncrement,\n          comment: a.comment || null,\n          enumValues: enumValues,\n        };\n\n        if (hasDefault) {\n          column.defaultValue = defaultValue;\n        }\n\n        return column;\n      }\n    );\n\n    const primaryKeys = columns.filter((c) => c.primaryKey).map((c) => c.name);\n\n    const rawIndexes: IndexSchema[] =\n      m.options.indexes?.map((idx: any) => ({\n        name: idx.name,\n        columns: idx.fields,\n        unique: !!idx.unique,\n        where: idx.where || null,\n        type: idx.type || null,\n        using: idx.using || null,\n      })) || [];\n\n    const uniques: UniqueConstraintSchema[] = [];\n    const uniqueColumnNames = new Set<string>();\n    const uniqueNameToColumns = new Map<string, string[]>();\n\n    columns.forEach((col) => {\n      if (col.unique && !col.primaryKey) {\n        const attr = attrs[col.name];\n        const uniqueValue = (attr as any).unique;\n\n        let uniqueName: string;\n        if (typeof uniqueValue === \"string\") {\n          uniqueName = uniqueValue;\n          if (!uniqueNameToColumns.has(uniqueName)) {\n            uniqueNameToColumns.set(uniqueName, []);\n          }\n          uniqueNameToColumns.get(uniqueName)!.push(col.name);\n        } else {\n          uniqueName = `${tableName}_${col.name}_unique`;\n          uniques.push({\n            name: uniqueName,\n            columns: [col.name],\n          });\n          uniqueColumnNames.add(col.name);\n        }\n      }\n    });\n\n    uniqueNameToColumns.forEach((cols, name) => {\n      uniques.push({\n        name,\n        columns: cols,\n      });\n      cols.forEach((col) => uniqueColumnNames.add(col));\n    });\n\n    const uniqueKeys = (m.options as any)?.uniqueKeys;\n    if (uniqueKeys) {\n      Object.entries(uniqueKeys).forEach(([name, cfg]: any) => {\n        const isDuplicate = uniques.some(\n          (u) =>\n            u.name === name ||\n            JSON.stringify(u.columns.sort()) ===\n              JSON.stringify(cfg.fields.sort())\n        );\n\n        if (!isDuplicate) {\n          uniques.push({ name, columns: cfg.fields });\n          cfg.fields.forEach((field: string) => uniqueColumnNames.add(field));\n        }\n      });\n    }\n\n    rawIndexes.forEach((idx) => {\n      if (idx.unique) {\n        const isDuplicate = uniques.some(\n          (u) =>\n            u.name === idx.name ||\n            JSON.stringify(u.columns.sort()) ===\n              JSON.stringify(idx.columns.sort())\n        );\n\n        if (!isDuplicate) {\n          uniques.push({\n            name: idx.name,\n            columns: idx.columns,\n          });\n          idx.columns.forEach((col) => uniqueColumnNames.add(col));\n        }\n      }\n    });\n\n    uniqueColumnNames.forEach((colName) => {\n      const col = columns.find((c) => c.name === colName);\n      if (col) {\n        col.unique = false;\n      }\n    });\n\n    const indexes = rawIndexes.filter((idx) => {\n      if (idx.unique) return false;\n\n      if (idx.columns.some((col) => uniqueColumnNames.has(col))) {\n        return false;\n      }\n\n      return true;\n    });\n\n    const checks: CheckConstraintSchema[] = [];\n    const validate = (m.options as any)?.validate;\n    if (validate) {\n      Object.entries(validate).forEach(([name, expr]: any) => {\n        if (typeof expr === \"string\") {\n          checks.push({ name, expression: expr });\n        }\n      });\n    }\n\n    const foreignKeys: ForeignKeySchema[] = [];\n\n    Object.values(m.associations).forEach((assoc: any) => {\n      if (assoc.associationType === \"BelongsTo\") {\n        const fk = assoc.foreignKey;\n        const col = columns.find((c) => c.name === fk);\n        if (col) col.unique = false;\n\n        foreignKeys.push({\n          name: assoc.options?.constraintName || `${tableName}_${fk}_fkey`,\n          column: fk,\n          referencedTable: assoc.target.getTableName(),\n          referencedColumn: assoc.target.primaryKeyAttribute,\n          onDelete: assoc.options?.onDelete || \"CASCADE\",\n          onUpdate: assoc.options?.onUpdate || \"CASCADE\",\n        });\n      }\n    });\n\n    const isJoinTable = isManyToManyJoinTable(\n      tableName,\n      columns,\n      foreignKeys,\n      indexes\n    );\n\n    if (isJoinTable) {\n      const fkColumns = foreignKeys.map((fk) => fk.column);\n      const mainFKs = fkColumns.slice(0, 2);\n\n      const hasUniqueConstraint = uniques.some((u) => {\n        const sortedU = [...u.columns].sort();\n        const sortedFK = [...mainFKs].sort();\n        return (\n          sortedU.length === sortedFK.length &&\n          sortedU.every((col, i) => col === sortedFK[i])\n        );\n      });\n\n      if (!hasUniqueConstraint) {\n        const constraintName = `${tableName}_${mainFKs.join(\"_\")}_uq`;\n        uniques.push({\n          name: constraintName,\n          columns: mainFKs,\n        });\n      }\n\n      fkColumns.forEach((fkCol) => {\n        const col = columns.find((c) => c.name === fkCol);\n        if (col) col.unique = false;\n      });\n    }\n\n    schema.tables.push({\n      name: tableName,\n      columns,\n      indexes,\n      foreignKeys,\n      uniques,\n      checks,\n      primaryKeys,\n    });\n  }\n\n  return schema;\n}\n","import { spawnSync } from \"child_process\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { loadSeqmigConfig } from \"./load-seqmig\";\n\n/**\n * Loads the user DB config from a JS/TS config file.\n *\n * Supports:\n *  - CommonJS require\n *  - ESM default exports\n *  - TypeScript configs via tsx subprocess\n *  - JSON printed to stdout\n */\nexport async function loadUserSequelizeConfig(customPath?: string) {\n  const seqmig = loadSeqmigConfig();\n  const file = customPath || seqmig.config;\n\n  if (!file) {\n    throw new Error(\"‚ùå No 'config' entry found in .seqmig file\");\n  }\n\n  const fullPath = path.resolve(process.cwd(), file);\n\n  if (!fs.existsSync(fullPath)) {\n    throw new Error(`‚ùå Config file does not exist: ${fullPath}`);\n  }\n\n  // ---------------------------\n  // 1Ô∏è‚É£ TS CONFIG (.ts / .mts)\n  // ---------------------------\n  if (/\\.(ts|mts|cts)$/.test(fullPath)) {\n    const result = spawnSync(\"npx\", [\"tsx\", fullPath], {\n      cwd: process.cwd(),\n      encoding: \"utf-8\",\n    });\n\n    if (result.stderr && result.stderr.trim().length > 0) {\n      throw new Error(`‚ùå Failed to load TS config:\\n${result.stderr}`);\n    }\n\n    const stdout = result.stdout.trim();\n\n    if (!stdout) {\n      throw new Error(\n        `‚ùå TS config printed no JSON. Add:\\nconsole.log(JSON.stringify(config));`\n      );\n    }\n\n    let raw;\n    try {\n      raw = JSON.parse(stdout);\n    } catch (e) {\n      console.error(\"‚ùå Raw TSX output:\", stdout);\n      throw new Error(`‚ùå Invalid JSON output from TS config: ${e}`);\n    }\n\n    return selectEnvConfig(raw, seqmig);\n  }\n\n  // ---------------------------\n  // 2Ô∏è‚É£ JS CONFIG (.js / .cjs)\n  // ---------------------------\n  if (fullPath.endsWith(\".js\") || fullPath.endsWith(\".cjs\")) {\n    const mod = require(fullPath);\n    const raw = normalizeModule(mod);\n    return selectEnvConfig(raw, seqmig);\n  }\n\n  // ---------------------------\n  // 3Ô∏è‚É£ JSON CONFIG\n  // ---------------------------\n  if (fullPath.endsWith(\".json\")) {\n    const raw = JSON.parse(fs.readFileSync(fullPath, \"utf8\"));\n    return selectEnvConfig(raw, seqmig);\n  }\n\n  throw new Error(`‚ùå Unsupported config format: ${fullPath}`);\n}\n\n/**\n * Extracts default export cleanly.\n */\nfunction normalizeModule(mod: any) {\n  if (!mod) return {};\n  if (mod.default) return mod.default;\n  return mod;\n}\n\n/**\n * Picks the correct environment block from the config.\n */\nfunction selectEnvConfig(rawConfig: any, seqmig: any) {\n  const env = seqmig.env || \"development\";\n\n  if (rawConfig[env]) {\n    return rawConfig[env];\n  }\n\n  return rawConfig;\n}\n","import fs from \"fs\";\nimport path from \"path\";\nimport YAML from \"yaml\";\n\nexport interface SeqmigConfig {\n  config?: string;\n  migrationDir?: string;\n  snapshotDir?: string;\n  dialect?: string;\n  useSequelizeCli?: boolean;\n}\n\nconst possibleFiles = [\n  \".seqmig\",\n  \".seqmig.json\",\n  \".seqmig.yaml\",\n  \".seqmig.yml\",\n  \".seqmig.js\",\n  \".seqmig.cjs\",\n];\n\nexport function loadSeqmigConfig(): SeqmigConfig {\n  const cwd = process.cwd();\n\n  for (const fileName of possibleFiles) {\n    const fullPath = path.join(cwd, fileName);\n\n    if (fs.existsSync(fullPath)) {\n      return parseSeqmigConfig(fullPath, cwd);\n    }\n  }\n\n  return {};\n}\n\nfunction parseSeqmigConfig(fullPath: string, cwd: string): SeqmigConfig {\n  const raw = fs.readFileSync(fullPath, \"utf8\").trim();\n\n  if (!raw) return {};\n\n  // JS / CJS configs\n  if (fullPath.endsWith(\".js\") || fullPath.endsWith(\".cjs\")) {\n    const mod = require(fullPath);\n    return mod.default || mod;\n  }\n\n  // YAML configs\n  if (fullPath.endsWith(\".yaml\") || fullPath.endsWith(\".yml\")) {\n    return YAML.parse(raw);\n  }\n\n  // JSON configs OR extensionless .seqmig file\n  const isExtensionless = fullPath === path.join(cwd, \".seqmig\");\n\n  if (isExtensionless || fullPath.endsWith(\".json\")) {\n    try {\n      return JSON.parse(raw);\n    } catch (err) {\n      console.error(`‚ùå Failed to parse JSON from: ${fullPath}`);\n      throw err;\n    }\n  }\n\n  return {};\n}\n","import { execa } from \"execa\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { diff } from \"./diff\";\nimport { generate } from \"./generator\";\nimport { introspect } from \"./introspect\";\nimport { loadSnapshot, saveSnapshot } from \"./state\";\n\nfunction hasSequelizeCli() {\n  const cwd = process.cwd();\n  const cliPath1 = path.join(cwd, \"node_modules/.bin/sequelize\");\n  const cliPath2 = path.join(cwd, \"node_modules/.bin/sequelize-cli\");\n  return fs.existsSync(cliPath1) || fs.existsSync(cliPath2);\n}\n\nexport async function preview() {\n  const before = loadSnapshot();\n  const after = await introspect();\n  const actions = diff(before, after);\n  console.log(JSON.stringify(actions, null, 2));\n}\n\nexport async function generateMigration() {\n  const before = loadSnapshot();\n  const after = await introspect();\n  const actions = diff(before, after);\n\n  if (!actions.length) {\n    console.log(\"No schema changes detected. No migration generated.\");\n    return;\n  }\n\n  const file = generate(actions);\n  saveSnapshot(after);\n  console.log(\"Generated migration:\", file);\n}\n\nexport async function runMigrations() {\n  if (!hasSequelizeCli()) {\n    console.log(\"‚ùå sequelize-cli not found in this project.\");\n    console.log(\"Install it with:\");\n    console.log(\"  pnpm add -D sequelize-cli\");\n    return;\n  }\n\n  console.log(\"‚ñ∂ Running migrations via sequelize-cli...\\n\");\n\n  await execa(\"npx\", [\"sequelize-cli\", \"db:migrate\"], {\n    stdio: \"inherit\",\n  });\n}\n\nexport async function rollbackLast() {\n  if (!hasSequelizeCli()) {\n    console.log(\"‚ùå sequelize-cli not found in this project.\");\n    console.log(\"Install it with:\");\n    console.log(\"  pnpm add -D sequelize-cli\");\n    return;\n  }\n\n  console.log(\"‚ñ∂ Rolling back last migration via sequelize-cli...\\n\");\n\n  await execa(\"npx\", [\"sequelize-cli\", \"db:migrate:undo\"], {\n    stdio: \"inherit\",\n  });\n}\n\nexport async function rebuildSnapshot() {\n  console.log(\"‚ö†Ô∏è Rebuilding snapshot in 3 seconds...\");\n  await new Promise((r) => setTimeout(r, 3000));\n\n  const db = await introspect();\n  saveSnapshot(db);\n\n  console.log(\"‚úì Snapshot rebuilt.\");\n}\n\nexport async function validateSnapshot() {\n  const snapshot = loadSnapshot();\n  const actual = await introspect();\n  const actions = diff(snapshot, actual);\n\n  if (actions.length === 0) {\n    console.log(\"‚úì Snapshot is in sync with database.\");\n    return;\n  }\n\n  console.log(\"‚ö†Ô∏è Snapshot is OUT OF SYNC:\");\n  console.log(JSON.stringify(actions, null, 2));\n}\n","import { DatabaseSchema, MigrationAction } from \"./schema-types\";\n\nfunction same(a: any, b: any) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n\nfunction columnSimilarity(a: string, b: string): number {\n  const normalize = (s: string) => s.toLowerCase().replace(/[_-]/g, \"\");\n  const na = normalize(a);\n  const nb = normalize(b);\n\n  if (na === nb) return 1;\n\n  const longer = na.length > nb.length ? na : nb;\n  const shorter = na.length > nb.length ? nb : na;\n\n  if (longer.includes(shorter)) return 0.8;\n\n  let matches = 0;\n  for (let i = 0; i < shorter.length; i++) {\n    if (longer.includes(shorter[i])) matches++;\n  }\n  return matches / longer.length;\n}\n\nfunction detectRenames(\n  beforeCols: any[],\n  afterCols: any[],\n  getName: (x: any) => string\n): Map<string, string> {\n  const renames = new Map<string, string>();\n  const droppedCols = beforeCols.filter(\n    (b) => !afterCols.find((a) => getName(a) === getName(b))\n  );\n  const addedCols = afterCols.filter(\n    (a) => !beforeCols.find((b) => getName(b) === getName(a))\n  );\n\n  for (const dropped of droppedCols) {\n    let bestMatch = null;\n    let bestScore = 0.7;\n\n    for (const added of addedCols) {\n      if (renames.has(getName(added))) continue;\n\n      const score = columnSimilarity(getName(dropped), getName(added));\n      if (score > bestScore) {\n        bestScore = score;\n        bestMatch = added;\n      }\n    }\n\n    if (bestMatch) {\n      renames.set(getName(dropped), getName(bestMatch));\n    }\n  }\n\n  return renames;\n}\n\nfunction sortByDependencies(actions: MigrationAction[]): MigrationAction[] {\n  const createTables = actions.filter((a) => a.kind === \"createTable\");\n  const dropFKs = actions.filter((a) => a.kind === \"dropFK\");\n  const addFKs = actions.filter((a) => a.kind === \"addFK\");\n  const dropTables = actions.filter((a) => a.kind === \"dropTable\");\n  const rest = actions.filter(\n    (a) =>\n      a.kind !== \"createTable\" &&\n      a.kind !== \"dropFK\" &&\n      a.kind !== \"addFK\" &&\n      a.kind !== \"dropTable\"\n  );\n\n  return [...dropFKs, ...createTables, ...rest, ...addFKs, ...dropTables];\n}\n\nfunction getUniqueColumns(uniques: any[]): Set<string> {\n  const uniqueCols = new Set<string>();\n  uniques.forEach((u) => {\n    if (u.columns.length === 1) {\n      uniqueCols.add(u.columns[0]);\n    }\n  });\n  return uniqueCols;\n}\n\nfunction filterRedundantIndexes(indexes: any[], uniques: any[]): any[] {\n  const uniqueCols = getUniqueColumns(uniques);\n\n  return indexes.filter((idx) => {\n    if (idx.unique) return false;\n\n    if (idx.columns.length === 1 && uniqueCols.has(idx.columns[0])) {\n      return false;\n    }\n\n    return true;\n  });\n}\n\nexport function diff(\n  before: DatabaseSchema,\n  after: DatabaseSchema\n): MigrationAction[] {\n  const out: MigrationAction[] = [];\n\n  after.tables.forEach((t) => {\n    if (!before.tables.find((x) => x.name === t.name)) {\n      out.push({ kind: \"createTable\", table: t });\n    }\n  });\n\n  before.tables.forEach((t) => {\n    if (!after.tables.find((x) => x.name === t.name)) {\n      out.push({ kind: \"dropTable\", tableName: t.name, backup: t });\n    }\n  });\n\n  after.tables.forEach((t) => {\n    const prev = before.tables.find((x) => x.name === t.name);\n    if (!prev) return;\n\n    const colRenames = detectRenames(prev.columns, t.columns, (c) => c.name);\n\n    colRenames.forEach((newName, oldName) => {\n      out.push({\n        kind: \"renameColumn\",\n        tableName: t.name,\n        oldName,\n        newName,\n      });\n    });\n\n    t.columns.forEach((c) => {\n      const p = prev.columns.find((x) => x.name === c.name);\n      const renamedFrom = Array.from(colRenames.entries()).find(\n        ([_, newN]) => newN === c.name\n      );\n\n      if (renamedFrom) {\n        const oldCol = prev.columns.find((x) => x.name === renamedFrom[0]);\n        if (oldCol && !same(oldCol, { ...c, name: oldCol.name })) {\n          out.push({\n            kind: \"alterColumn\",\n            tableName: t.name,\n            before: oldCol,\n            after: c,\n          });\n        }\n      } else if (!p) {\n        out.push({ kind: \"addColumn\", tableName: t.name, column: c });\n      } else if (!same(p, c)) {\n        out.push({\n          kind: \"alterColumn\",\n          tableName: t.name,\n          before: p,\n          after: c,\n        });\n      }\n    });\n\n    prev.columns.forEach((c) => {\n      const isRenamed = colRenames.has(c.name);\n      if (!t.columns.find((x) => x.name === c.name) && !isRenamed) {\n        out.push({\n          kind: \"dropColumn\",\n          tableName: t.name,\n          columnName: c.name,\n          backup: c,\n        });\n      }\n    });\n\n    if (!same(prev.primaryKeys, t.primaryKeys)) {\n      out.push({\n        kind: \"changePrimaryKey\",\n        tableName: t.name,\n        before: prev.primaryKeys,\n        after: t.primaryKeys,\n      });\n    }\n\n    const filteredPrevIndexes = filterRedundantIndexes(\n      prev.indexes,\n      prev.uniques\n    );\n    const filteredAfterIndexes = filterRedundantIndexes(t.indexes, t.uniques);\n\n    filteredAfterIndexes.forEach((i) => {\n      const p = filteredPrevIndexes.find((x) => x.name === i.name);\n      if (!p) out.push({ kind: \"createIndex\", tableName: t.name, index: i });\n      else if (!same(p, i)) {\n        out.push({\n          kind: \"dropIndex\",\n          tableName: t.name,\n          indexName: i.name,\n          backup: p,\n        });\n        out.push({ kind: \"createIndex\", tableName: t.name, index: i });\n      }\n    });\n\n    filteredPrevIndexes.forEach((i) => {\n      if (!filteredAfterIndexes.find((x) => x.name === i.name)) {\n        out.push({\n          kind: \"dropIndex\",\n          tableName: t.name,\n          indexName: i.name,\n          backup: i,\n        });\n      }\n    });\n\n    t.foreignKeys.forEach((fk) => {\n      const p = prev.foreignKeys.find((x) => x.name === fk.name);\n      if (!p) out.push({ kind: \"addFK\", tableName: t.name, fk });\n      else if (!same(p, fk)) {\n        out.push({\n          kind: \"dropFK\",\n          tableName: t.name,\n          fkName: p.name,\n          backup: p,\n        });\n        out.push({ kind: \"addFK\", tableName: t.name, fk });\n      }\n    });\n\n    prev.foreignKeys.forEach((fk) => {\n      if (!t.foreignKeys.find((x) => x.name === fk.name)) {\n        out.push({\n          kind: \"dropFK\",\n          tableName: t.name,\n          fkName: fk.name,\n          backup: fk,\n        });\n      }\n    });\n\n    const beforeUnique = prev.uniques || [];\n    const afterUnique = t.uniques || [];\n\n    afterUnique.forEach((u) => {\n      const old = beforeUnique.find((x) => x.name === u.name);\n      if (!old) out.push({ kind: \"addUnique\", tableName: t.name, unique: u });\n      else if (!same(old.columns, u.columns)) {\n        out.push({\n          kind: \"dropUnique\",\n          tableName: t.name,\n          uniqueName: old.name,\n          backup: old,\n        });\n        out.push({ kind: \"addUnique\", tableName: t.name, unique: u });\n      }\n    });\n\n    beforeUnique.forEach((u) => {\n      if (!afterUnique.find((x) => x.name === u.name)) {\n        out.push({\n          kind: \"dropUnique\",\n          tableName: t.name,\n          uniqueName: u.name,\n          backup: u,\n        });\n      }\n    });\n\n    const beforeChecks = prev.checks || [];\n    const afterChecks = t.checks || [];\n\n    afterChecks.forEach((ch) => {\n      const old = beforeChecks.find((x) => x.name === ch.name);\n      if (!old) out.push({ kind: \"addCheck\", tableName: t.name, check: ch });\n      else if (!same(old, ch)) {\n        out.push({\n          kind: \"dropCheck\",\n          tableName: t.name,\n          checkName: old.name,\n          backup: old,\n        });\n        out.push({ kind: \"addCheck\", tableName: t.name, check: ch });\n      }\n    });\n\n    beforeChecks.forEach((ch) => {\n      if (!afterChecks.find((x) => x.name === ch.name)) {\n        out.push({\n          kind: \"dropCheck\",\n          tableName: t.name,\n          checkName: ch.name,\n          backup: ch,\n        });\n      }\n    });\n  });\n\n  return sortByDependencies(out);\n}\n","import fs from \"fs\";\nimport path from \"path\";\nimport { MigrationAction } from \"./schema-types\";\n\nfunction mapType(dbType: string, enumValues?: string[]) {\n  const upper = dbType.toUpperCase();\n\n  if (upper.includes(\"[]\") || upper.includes(\"ARRAY\")) {\n    let innerType = \"Sequelize.STRING\";\n\n    const bracketMatch = dbType.match(/^([A-Z]+)(?:\\([^)]+\\))?\\[\\]/i);\n    const arrayMatch = dbType.match(/ARRAY\\((.*?)\\)/i);\n\n    if (bracketMatch) {\n      const baseType = bracketMatch[1].toUpperCase();\n      if (baseType.includes(\"INT\")) innerType = \"Sequelize.INTEGER\";\n      else if (baseType.includes(\"BIGINT\")) innerType = \"Sequelize.BIGINT\";\n      else if (baseType.includes(\"TEXT\")) innerType = \"Sequelize.TEXT\";\n      else if (baseType.includes(\"BOOLEAN\")) innerType = \"Sequelize.BOOLEAN\";\n      else if (baseType.includes(\"DATE\") || baseType.includes(\"TIMESTAMP\"))\n        innerType = \"Sequelize.DATE\";\n      else if (baseType.includes(\"UUID\")) innerType = \"Sequelize.UUID\";\n      else if (baseType.includes(\"JSON\")) innerType = \"Sequelize.JSON\";\n      else if (baseType.includes(\"JSONB\")) innerType = \"Sequelize.JSONB\";\n      else if (baseType.includes(\"DECIMAL\")) innerType = \"Sequelize.DECIMAL\";\n      else if (baseType.includes(\"FLOAT\") || baseType.includes(\"REAL\"))\n        innerType = \"Sequelize.FLOAT\";\n      else innerType = \"Sequelize.STRING\";\n    } else if (arrayMatch) {\n      const baseType = arrayMatch[1].toUpperCase();\n      if (baseType.includes(\"INT\")) innerType = \"Sequelize.INTEGER\";\n      else if (baseType.includes(\"BIGINT\")) innerType = \"Sequelize.BIGINT\";\n      else if (baseType.includes(\"TEXT\")) innerType = \"Sequelize.TEXT\";\n      else if (baseType.includes(\"BOOLEAN\")) innerType = \"Sequelize.BOOLEAN\";\n      else if (baseType.includes(\"DATE\") || baseType.includes(\"TIMESTAMP\"))\n        innerType = \"Sequelize.DATE\";\n      else if (baseType.includes(\"UUID\")) innerType = \"Sequelize.UUID\";\n      else if (baseType.includes(\"JSON\")) innerType = \"Sequelize.JSON\";\n      else if (baseType.includes(\"JSONB\")) innerType = \"Sequelize.JSONB\";\n      else if (baseType.includes(\"DECIMAL\")) innerType = \"Sequelize.DECIMAL\";\n      else if (baseType.includes(\"FLOAT\") || baseType.includes(\"REAL\"))\n        innerType = \"Sequelize.FLOAT\";\n      else innerType = \"Sequelize.STRING\";\n    }\n\n    return `Sequelize.ARRAY(${innerType})`;\n  }\n\n  if (upper.startsWith(\"ENUM\") || upper.includes(\"ENUM(\") || enumValues) {\n    if (enumValues && enumValues.length > 0) {\n      return `Sequelize.ENUM(${enumValues.map((v) => `\"${v}\"`).join(\", \")})`;\n    }\n    const startIdx = dbType.indexOf(\"(\");\n    const endIdx = dbType.lastIndexOf(\")\");\n    if (startIdx !== -1 && endIdx !== -1) {\n      const inner = dbType.slice(startIdx + 1, endIdx);\n      const values = inner\n        .split(\",\")\n        .map((v) => v.trim().replace(/^[\"']+|[\"']+$/g, \"\"));\n      return `Sequelize.ENUM(${values.map((v) => `\"${v}\"`).join(\", \")})`;\n    }\n  }\n\n  if (upper.includes(\"TIMESTAMP\") || upper.includes(\"DATE\"))\n    return \"Sequelize.DATE\";\n  if (upper.includes(\"UUID\")) return \"Sequelize.UUID\";\n  if (upper.includes(\"BIGINT\")) return \"Sequelize.BIGINT\";\n  if (upper.includes(\"INT\")) return \"Sequelize.INTEGER\";\n  if (upper.includes(\"TEXT\")) return \"Sequelize.TEXT\";\n  if (upper.includes(\"CHAR\") || upper.includes(\"STRING\"))\n    return \"Sequelize.STRING\";\n  if (upper.includes(\"BOOLEAN\")) return \"Sequelize.BOOLEAN\";\n  if (upper.includes(\"JSONB\")) return \"Sequelize.JSONB\";\n  if (upper.includes(\"JSON\")) return \"Sequelize.JSON\";\n  if (upper.includes(\"DECIMAL\")) return \"Sequelize.DECIMAL\";\n  if (upper.includes(\"FLOAT\") || upper.includes(\"REAL\"))\n    return \"Sequelize.FLOAT\";\n\n  return \"Sequelize.STRING\";\n}\n\nfunction col(c: any) {\n  const parts: string[] = [];\n\n  parts.push(`type: ${mapType(c.dbType, c.enumValues)}`);\n\n  parts.push(`allowNull: ${c.allowNull}`);\n\n  parts.push(`primaryKey: ${c.primaryKey}`);\n\n  parts.push(`unique: ${c.unique}`);\n\n  if (c.hasOwnProperty(\"defaultValue\")) {\n    let defaultValue = \"null\";\n\n    if (c.defaultValue === \"NOW\") {\n      defaultValue = 'Sequelize.fn(\"NOW\")';\n    } else if (c.defaultValue === \"UUID_FUNCTION\") {\n      defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n    } else if (c.defaultValue !== null && c.defaultValue !== undefined) {\n      const defaultStr = String(c.defaultValue);\n\n      if (\n        typeof c.defaultValue === \"function\" ||\n        defaultStr === \"[Function]\" ||\n        defaultStr.includes(\"function\")\n      ) {\n        if (\n          c.name === \"id\" &&\n          (c.type === \"UUID\" || c.dbType?.includes(\"UUID\"))\n        ) {\n          defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n        } else {\n          defaultValue = \"Sequelize.UUIDV4\";\n        }\n      } else if (Array.isArray(c.defaultValue)) {\n        defaultValue = JSON.stringify(c.defaultValue);\n      } else {\n        defaultValue = JSON.stringify(c.defaultValue);\n      }\n    } else if (\n      c.name === \"id\" &&\n      c.primaryKey &&\n      (c.type === \"UUID\" || c.dbType?.includes(\"UUID\"))\n    ) {\n      defaultValue = 'Sequelize.fn(\"gen_random_uuid\")';\n    }\n\n    parts.push(`defaultValue: ${defaultValue}`);\n  }\n\n  return `{\n    ${parts.join(\",\\n    \")}\n  }`;\n}\n\nexport function generate(actions: MigrationAction[]): string | null {\n  if (!actions.length) return null;\n\n  const ts = new Date().toISOString().replace(/[:.]/g, \"-\");\n  const name = `${ts}-auto-migration.cjs`;\n  const dir = path.join(process.cwd(), \"src/migrations\");\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n\n  const createTables: string[] = [];\n  const addConstraints: string[] = [];\n  const addIndexes: string[] = [];\n  const otherUp: string[] = [];\n\n  const dropConstraints: string[] = [];\n  const dropTables: string[] = [];\n  const otherDown: string[] = [];\n\n  actions.forEach((a) => {\n    if (a.kind === \"createTable\") {\n      const columns = a.table.columns\n        .map((c) => `\"${c.name}\": ${col(c)}`)\n        .join(\",\\n      \");\n\n      createTables.push(`await queryInterface.createTable(\"${a.table.name}\", {\n      ${columns}\n    });`);\n\n      a.table.foreignKeys.forEach((fk) => {\n        addConstraints.push(`await queryInterface.addConstraint(\"${\n          a.table.name\n        }\", {\n      type: \"foreign key\",\n      fields: [\"${fk.column}\"],\n      name: \"${fk.name}\",\n      references: { table: \"${fk.referencedTable}\", field: \"${\n          fk.referencedColumn\n        }\" },\n      onDelete: ${fk.onDelete ? `\"${fk.onDelete}\"` : \"null\"},\n      onUpdate: ${fk.onUpdate ? `\"${fk.onUpdate}\"` : \"null\"}\n    });`);\n\n        dropConstraints.push(\n          `await queryInterface.removeConstraint(\"${a.table.name}\", \"${fk.name}\");`\n        );\n      });\n\n      a.table.uniques.forEach((u) => {\n        addConstraints.push(`await queryInterface.addConstraint(\"${\n          a.table.name\n        }\", {\n      type: \"unique\",\n      name: \"${u.name}\",\n      fields: ${JSON.stringify(u.columns)}\n    });`);\n\n        dropConstraints.push(\n          `await queryInterface.removeConstraint(\"${a.table.name}\", \"${u.name}\");`\n        );\n      });\n\n      a.table.indexes.forEach((idx) => {\n        if (!idx.unique) {\n          const options: any = {\n            name: idx.name,\n            unique: idx.unique,\n          };\n          if (idx.where) options.where = idx.where;\n\n          addIndexes.push(\n            `await queryInterface.addIndex(\"${a.table.name}\", ${JSON.stringify(\n              idx.columns\n            )}, ${JSON.stringify(options)});`\n          );\n        }\n      });\n\n      dropTables.push(`await queryInterface.dropTable(\"${a.table.name}\");`);\n    }\n\n    if (a.kind === \"dropTable\") {\n      otherUp.push(`await queryInterface.dropTable(\"${a.tableName}\");`);\n    }\n\n    if (a.kind === \"addColumn\") {\n      otherUp.push(\n        `await queryInterface.addColumn(\"${a.tableName}\", \"${\n          a.column.name\n        }\", ${col(a.column)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.removeColumn(\"${a.tableName}\", \"${a.column.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropColumn\") {\n      otherUp.push(\n        `await queryInterface.removeColumn(\"${a.tableName}\", \"${a.columnName}\");`\n      );\n    }\n\n    if (a.kind === \"alterColumn\") {\n      otherUp.push(\n        `await queryInterface.changeColumn(\"${a.tableName}\", \"${\n          a.after.name\n        }\", ${col(a.after)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.changeColumn(\"${a.tableName}\", \"${\n          a.before.name\n        }\", ${col(a.before)});`\n      );\n    }\n\n    if (a.kind === \"createIndex\") {\n      const options: any = {\n        name: a.index.name,\n        unique: a.index.unique,\n      };\n      if (a.index.where) options.where = a.index.where;\n\n      otherUp.push(\n        `await queryInterface.addIndex(\"${a.tableName}\", ${JSON.stringify(\n          a.index.columns\n        )}, ${JSON.stringify(options)});`\n      );\n      otherDown.unshift(\n        `await queryInterface.removeIndex(\"${a.tableName}\", \"${a.index.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropIndex\") {\n      otherUp.push(\n        `await queryInterface.removeIndex(\"${a.tableName}\", \"${a.indexName}\");`\n      );\n    }\n\n    if (a.kind === \"addFK\") {\n      otherUp.push(`await queryInterface.addConstraint(\"${a.tableName}\", {\n  type: \"foreign key\",\n  fields: [\"${a.fk.column}\"],\n  name: \"${a.fk.name}\",\n  references: { table: \"${a.fk.referencedTable}\", field: \"${\n        a.fk.referencedColumn\n      }\" },\n  onDelete: ${a.fk.onDelete ? `\"${a.fk.onDelete}\"` : \"null\"},\n  onUpdate: ${a.fk.onUpdate ? `\"${a.fk.onUpdate}\"` : \"null\"}\n});`);\n\n      otherDown.unshift(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.fk.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropFK\") {\n      otherUp.push(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.fkName}\");`\n      );\n    }\n\n    if (a.kind === \"addUnique\") {\n      otherUp.push(`await queryInterface.addConstraint(\"${a.tableName}\", {\n  type: \"unique\",\n  name: \"${a.unique.name}\",\n  fields: ${JSON.stringify(a.unique.columns)}\n});`);\n      otherDown.unshift(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.unique.name}\");`\n      );\n    }\n\n    if (a.kind === \"dropUnique\") {\n      otherUp.push(\n        `await queryInterface.removeConstraint(\"${a.tableName}\", \"${a.uniqueName}\");`\n      );\n    }\n  });\n\n  const up = [\n    ...createTables,\n    ...addConstraints,\n    ...addIndexes,\n    ...otherUp,\n  ].filter(Boolean);\n\n  const down = [...dropConstraints, ...dropTables, ...otherDown].filter(\n    Boolean\n  );\n\n  const content = `\n\"use strict\";\nmodule.exports = {\n  async up(queryInterface, Sequelize) {\n    const transaction = await queryInterface.sequelize.transaction();\n    try {\n      ${up.length ? up.join(\"\\n      \") : \"\"}\n      await transaction.commit();\n    } catch (error) {\n      await transaction.rollback();\n      throw error;\n    }\n  },\n  async down(queryInterface, Sequelize) {\n    const transaction = await queryInterface.sequelize.transaction();\n    try {\n      ${down.length ? down.join(\"\\n      \") : \"\"}\n      await transaction.commit();\n    } catch (error) {\n      await transaction.rollback();\n      throw error;\n    }\n  },\n};\n`;\n\n  const file = path.join(dir, name);\n  fs.writeFileSync(file, content);\n  return file;\n}\n","import fs from \"fs\";\nimport path from \"path\";\nimport { loadSeqmigConfig } from \"../utils/load-seqmig\";\nimport { DatabaseSchema } from \"./schema-types\";\n\nexport function getSnapshotPaths() {\n  const cfg = loadSeqmigConfig();\n\n  const snapshotDir = cfg.snapshotDir || \".seqmig/snapshots\";\n  const migrationDir = cfg.migrationDir || \"migrations\";\n\n  const SNAPSHOT_FILE = path.join(\n    process.cwd(),\n    snapshotDir,\n    \"schema-snapshot.json\"\n  );\n  const SNAPSHOT_BACKUP_DIR = path.join(process.cwd(), snapshotDir, \"backups\");\n\n  return { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR, migrationDir, snapshotDir };\n}\n\nexport function loadSnapshot(): DatabaseSchema {\n  const { SNAPSHOT_FILE } = getSnapshotPaths();\n\n  if (!fs.existsSync(SNAPSHOT_FILE)) {\n    return { tables: [] };\n  }\n\n  const raw = fs.readFileSync(SNAPSHOT_FILE, \"utf8\");\n  return JSON.parse(raw) as DatabaseSchema;\n}\n\nexport function saveSnapshot(schema: DatabaseSchema) {\n  const { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n  const dir = path.dirname(SNAPSHOT_FILE);\n\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n  if (!fs.existsSync(SNAPSHOT_BACKUP_DIR))\n    fs.mkdirSync(SNAPSHOT_BACKUP_DIR, { recursive: true });\n\n  if (fs.existsSync(SNAPSHOT_FILE)) {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \"-\");\n    const backupFile = path.join(\n      SNAPSHOT_BACKUP_DIR,\n      `snapshot-${timestamp}.json`\n    );\n    fs.copyFileSync(SNAPSHOT_FILE, backupFile);\n    cleanOldBackups(SNAPSHOT_BACKUP_DIR, 20);\n  }\n\n  fs.writeFileSync(SNAPSHOT_FILE, JSON.stringify(schema, null, 2));\n}\n\nfunction cleanOldBackups(backupDir: string, keepCount: number) {\n  const backups = fs\n    .readdirSync(backupDir)\n    .filter((f) => f.startsWith(\"snapshot-\"))\n    .sort()\n    .reverse();\n\n  backups.slice(keepCount).forEach((file) => {\n    fs.unlinkSync(path.join(backupDir, file));\n  });\n}\n\nexport function listBackups(): string[] {\n  const { SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n  if (!fs.existsSync(SNAPSHOT_BACKUP_DIR)) return [];\n  return fs\n    .readdirSync(SNAPSHOT_BACKUP_DIR)\n    .filter((f) => f.startsWith(\"snapshot-\"))\n    .sort()\n    .reverse();\n}\n\nexport function restoreBackup(backupFile: string) {\n  const { SNAPSHOT_FILE, SNAPSHOT_BACKUP_DIR } = getSnapshotPaths();\n\n  const backupPath = path.join(SNAPSHOT_BACKUP_DIR, backupFile);\n  if (!fs.existsSync(backupPath)) {\n    throw new Error(`Backup file not found: ${backupFile}`);\n  }\n\n  fs.copyFileSync(backupPath, SNAPSHOT_FILE);\n  console.log(`Restored snapshot from ${backupFile}`);\n}\n","import { loadSeqmigConfig } from \"./utils/load-seqmig\";\n\nexport function debugConfig() {\n  const seqmig = loadSeqmigConfig();\n  console.log(\"üìå Loaded .seqmig config:\", seqmig);\n\n  if (seqmig.config) {\n    try {\n      const db = require(process.cwd() + \"/\" + seqmig.config);\n      console.log(\"üìå Loaded DB config:\", db);\n    } catch (e) {\n      console.log(\"‚ùå Failed to load DB config:\", e);\n    }\n  } else {\n    console.log(\"‚ùå No config found in .seqmig\");\n  }\n}\n"],"mappings":"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","names":["import_fs","import_path","possibleFiles","loadSeqmigConfig","cwd","process","fileName","fullPath","path","join","fs","existsSync","parseSeqmigConfig","raw","readFileSync","trim","endsWith","mod","require","default","YAML","parse","isExtensionless","JSON","err","console","error","loadUserSequelizeConfig","customPath","seqmig","loadSeqmigConfig","file","config","Error","fullPath","path","resolve","process","cwd","fs","existsSync","test","result","spawnSync","encoding","stderr","trim","length","stdout","raw","JSON","parse","e","console","error","selectEnvConfig","endsWith","mod","require","normalizeModule","readFileSync","default","rawConfig","env","toScalar","db","t","toUpperCase","includes","startsWith","extractEnumValues","dbType","upper","undefined","startIdx","indexOf","endIdx","lastIndexOf","inner","slice","split","map","v","trim","replace","isManyToManyJoinTable","tableName","columns","foreignKeys","indexes","length","fkColumns","fk","column","hasCompositeUnique","some","idx","unique","fkInIndex","filter","col","introspect","configPath","cfg","loadUserSequelizeConfig","sequelize","Sequelize","logging","authenticate","schema","tables","models","modelManager","m","String","getTableName","attrs","getAttributes","Object","entries","name","a","raw","type","toString","isArray","key","isEnum","values","Array","enumValues","defaultValue","hasDefault","defaultStr","beforeTypeCast","allowNull","primaryKey","autoIncrement","comment","primaryKeys","c","rawIndexes","options","fields","where","using","uniques","uniqueColumnNames","Set","uniqueNameToColumns","Map","forEach","attr","uniqueValue","uniqueName","has","set","get","push","add","cols","uniqueKeys","isDuplicate","u","JSON","stringify","sort","field","colName","find","checks","validate","expr","expression","associations","assoc","associationType","foreignKey","constraintName","referencedTable","target","referencedColumn","primaryKeyAttribute","onDelete","onUpdate","isJoinTable","mainFKs","hasUniqueConstraint","sortedU","sortedFK","every","i","join","fkCol","import_fs","import_path","same","a","b","JSON","stringify","columnSimilarity","normalize","s","toLowerCase","replace","na","nb","longer","length","shorter","includes","matches","i","detectRenames","beforeCols","afterCols","getName","renames","Map","droppedCols","filter","find","addedCols","dropped","bestMatch","bestScore","added","has","score","set","sortByDependencies","actions","createTables","kind","dropFKs","addFKs","dropTables","rest","getUniqueColumns","uniques","uniqueCols","Set","forEach","u","columns","add","filterRedundantIndexes","indexes","idx","unique","diff","before","after","out","tables","t","x","name","push","table","tableName","backup","prev","colRenames","c","newName","oldName","p","renamedFrom","Array","from","entries","_","newN","oldCol","column","isRenamed","columnName","primaryKeys","filteredPrevIndexes","filteredAfterIndexes","index","indexName","foreignKeys","fk","fkName","beforeUnique","afterUnique","old","uniqueName","beforeChecks","checks","afterChecks","ch","check","checkName","import_fs","import_path","mapType","dbType","enumValues","upper","toUpperCase","includes","innerType","bracketMatch","match","arrayMatch","baseType","startsWith","length","map","v","join","startIdx","indexOf","endIdx","lastIndexOf","inner","slice","values","split","trim","replace","col","c","parts","push","allowNull","primaryKey","unique","hasOwnProperty","defaultValue","undefined","defaultStr","String","name","type","Array","isArray","JSON","stringify","generate","actions","ts","Date","toISOString","dir","path","process","cwd","fs","existsSync","mkdirSync","recursive","createTables","addConstraints","addIndexes","otherUp","dropConstraints","dropTables","otherDown","forEach","a","kind","columns","table","foreignKeys","fk","column","referencedTable","referencedColumn","onDelete","onUpdate","uniques","u","indexes","idx","options","where","tableName","unshift","columnName","after","before","index","indexName","fkName","uniqueName","up","filter","Boolean","down","content","file","writeFileSync","import_fs","import_path","getSnapshotPaths","cfg","loadSeqmigConfig","snapshotDir","migrationDir","SNAPSHOT_FILE","path","join","process","cwd","SNAPSHOT_BACKUP_DIR","loadSnapshot","fs","existsSync","tables","raw","readFileSync","JSON","parse","saveSnapshot","schema","dir","dirname","mkdirSync","recursive","timestamp","Date","toISOString","replace","backupFile","copyFileSync","cleanOldBackups","writeFileSync","stringify","backupDir","keepCount","backups","readdirSync","filter","f","startsWith","sort","reverse","slice","forEach","file","unlinkSync","listBackups","restoreBackup","backupPath","Error","console","log","hasSequelizeCli","cwd","process","cliPath1","path","join","cliPath2","fs","existsSync","preview","before","loadSnapshot","after","introspect","actions","diff","console","log","JSON","stringify","generateMigration","length","file","generate","saveSnapshot","runMigrations","execa","stdio","rollbackLast","rebuildSnapshot","Promise","r","setTimeout","db","validateSnapshot","snapshot","actual","debugConfig","seqmig","loadSeqmigConfig","console","log","config","db","require","process","cwd","e","wrap","fn","args","err","console","error","process","exit","runCli","program","Command","name","description","version","command","action","preview","generateMigration","runMigrations","rollbackLast","rebuildSnapshot","validateSnapshot","backups","listBackups","length","log","forEach","b","i","backup","restoreBackup","option","opts","result","introspect","config","parseAsync","argv","require","main","module"]}